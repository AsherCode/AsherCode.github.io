<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">

<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="redis,mongodb,Spring boot,Swagger,JMS,AMQP,EhCache," />










<meta name="description" content="你的窝以后可就是我的窝   springboot进阶">
<meta name="keywords" content="redis,mongodb,Spring boot,Swagger,JMS,AMQP,EhCache">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot进阶">
<meta property="og:url" content="http://ashercode.github.io/post/springboot进阶.html">
<meta property="og:site_name" content="王小建">
<meta property="og:description" content="你的窝以后可就是我的窝   springboot进阶">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-03-30T02:30:34.974Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SpringBoot进阶">
<meta name="twitter:description" content="你的窝以后可就是我的窝   springboot进阶">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'I14VESP3SJ',
      apiKey: 'a817c1ce9320d227f97800013070f068',
      indexName: 'AsherCode',
      hits: {"per_page":10},
      labels: {"input_placeholder":"请输入关键字","hits_empty":"根本找不到好吗: ${query}","hits_stats":"${hits} 条相关记录，耗时 ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ashercode.github.io/post/springboot进阶.html"/>






  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "c9e4f89d"
    });
  daovoice('update');
  </script>

  <title>SpringBoot进阶 | 王小建</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?df44f8c13996af363c362aad197f9bef";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

	

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

<a href="https://github.com/AsherCode" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">王小建</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">AsherCode的个人小站</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ashercode.github.io/post/springboot进阶.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AsherCode">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王小建">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">SpringBoot进阶</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-26T14:14:53+08:00">
                2018-03-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/进阶系列/" itemprop="url" rel="index">
                    <span itemprop="name">进阶系列</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/post/springboot进阶.html" class="leancloud_visitors" data-flag-title="SpringBoot进阶">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
				 <span>℃</span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  13,704
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  73
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote class="blockquote-center"><p>你的窝以后可就是我的窝 </p>
</blockquote>
<div class="note info"><p>springboot进阶</p></div>
<a id="more"></a>
<h1 id="Restfull快速搭建"><a href="#Restfull快速搭建" class="headerlink" title="Restfull快速搭建"></a>Restfull快速搭建</h1><p>配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.5.3.RELEASE&lt;/version&gt;</span><br><span class="line">  &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">  &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">  &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure></p>
<p>Controller实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/index&quot;)</span><br><span class="line">public class IndexController &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping//http://localhost:8080/index</span><br><span class="line">	public String index() &#123;</span><br><span class="line">		return &quot;hello world&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// @RequestParam 简单类型的绑定，可以出来get和post</span><br><span class="line">	@RequestMapping(value = &quot;/get&quot;)//http://localhost:8080/index/get?name=%E7%8E%8B%E5%BB%BA</span><br><span class="line">	public HashMap&lt;String, Object&gt; get(@RequestParam String name) &#123;</span><br><span class="line">		HashMap&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		map.put(&quot;title&quot;, &quot;hello world&quot;);</span><br><span class="line">		map.put(&quot;name&quot;, name);</span><br><span class="line">		return map;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// @PathVariable 获得请求url中的动态参数</span><br><span class="line">	@RequestMapping(value = &quot;/get/&#123;id&#125;/&#123;name&#125;&quot;)//http://localhost:8080/index/get/1/wangjian</span><br><span class="line">	public User getUser(@PathVariable int id, @PathVariable String name) &#123;</span><br><span class="line">		User user = new User();</span><br><span class="line">		user.setId(id);</span><br><span class="line">		user.setName(name);</span><br><span class="line">		user.setDate(new Date());</span><br><span class="line">		return user;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class App &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(App.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><p>properties配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#这个优先级相对于resources/config/application.properties较低</span><br><span class="line">#32位随机字符串</span><br><span class="line">roncoo.secret=$&#123;random.value&#125;</span><br><span class="line">#int类型的随机数字</span><br><span class="line">roncoo.number=$&#123;random.int&#125;</span><br><span class="line">roncoo.name=www.roncoo.com</span><br><span class="line">#属性占位符属性</span><br><span class="line">roncoo.desc=$&#123;roncoo.name&#125; is a domain name</span><br><span class="line">#应用端口</span><br><span class="line">server.port=8090</span><br><span class="line">#时间格式化</span><br><span class="line">spring.jackson.date-format=yyyy-MM-dd HH:mm:ss</span><br><span class="line">#时区设置</span><br><span class="line">spring.jackson.time-zone=Asia/Chongqing</span><br></pre></td></tr></table></figure></p>
<p>yaml配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#这个优先级较高,同理相对于resources/config/application.yaml优先级较低</span><br><span class="line">#自定义配置</span><br><span class="line">roncoo: </span><br><span class="line">  secret: $&#123;random.value&#125;</span><br><span class="line">  number: $&#123;random.int&#125;</span><br><span class="line">  name: www.roncoo.com</span><br><span class="line">  desc: $&#123;roncoo.name&#125; is a domain name</span><br><span class="line"></span><br><span class="line">#端口</span><br><span class="line">server: </span><br><span class="line">  port: 8090</span><br><span class="line">  </span><br><span class="line">#spring jsckson</span><br><span class="line">spring: </span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-dd HH:mm:ss</span><br><span class="line">    time-zone: Asia/Chongqing</span><br></pre></td></tr></table></figure></p>
<p>Controller实现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// @RequestParam 简单类型的绑定，可以出来get和post</span><br><span class="line">@RequestMapping(value = &quot;/get&quot;)//http://localhost:8080/index/get?name=wj</span><br><span class="line">public HashMap&lt;String, Object&gt; get(@RequestParam String name) &#123;</span><br><span class="line">	HashMap&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">	map.put(&quot;title&quot;, &quot;hello world&quot;);</span><br><span class="line">	map.put(&quot;name&quot;, name);</span><br><span class="line">	map.put(&quot;secret&quot;, secret);</span><br><span class="line">	map.put(&quot;id&quot;, id);</span><br><span class="line">	map.put(&quot;desc&quot;, desc);</span><br><span class="line">	return map;</span><br><span class="line">&#125;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo31Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo31Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="配置多环境"><a href="#配置多环境" class="headerlink" title="配置多环境"></a>配置多环境</h1><h2 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h2><p>applicatoin.properties添加spring.profiles.active=dev则激活开发环境，开发环境将覆盖application.properties<br>生产环境：application-prod.properties<br>测试环境：application-test.properties<br>开发环境：application-dev.properties<br>打成包后，可以在命令中修改配置环境java -jar myapp.jar –spring.profiles.active=dev</p>
<h2 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h2><p>可以一个文件配置三个环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#配置文件环境配置</span><br><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev</span><br><span class="line">    </span><br><span class="line">  #jackson</span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-dd HH:mm:ss</span><br><span class="line">    time-zone: Asia/Chongqing</span><br><span class="line"></span><br><span class="line">#端口</span><br><span class="line">server: </span><br><span class="line">  port: 8888</span><br><span class="line">    </span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: dev</span><br><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">  </span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: prod</span><br><span class="line">server:</span><br><span class="line">  port: 8082</span><br><span class="line">  </span><br><span class="line">---</span><br><span class="line">spring:</span><br><span class="line">  profiles: test</span><br><span class="line">server:</span><br><span class="line">  port: 8081</span><br></pre></td></tr></table></figure></p>
<h1 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h1><h2 id="log4j2"><a href="#log4j2" class="headerlink" title="log4j2"></a>log4j2</h2><p>添加pom.xml,默认读取/resources/log4j2.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">  &lt;exclusions&gt;</span><br><span class="line">    &lt;exclusion&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;</span><br><span class="line">    &lt;/exclusion&gt;</span><br><span class="line">  &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- 使用log4j2 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加/resources/log4j2.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;!-- 文件输出格式 --&gt;</span><br><span class="line">		&lt;property name=&quot;PATTERN&quot;&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; |-%-5level [%thread] %c [%L] -| %msg%n&lt;/property&gt;</span><br><span class="line">	&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">	&lt;appenders&gt;</span><br><span class="line">		&lt;Console name=&quot;CONSOLE&quot; target=&quot;system_out&quot;&gt;</span><br><span class="line">			&lt;PatternLayout pattern=&quot;$&#123;PATTERN&#125;&quot; /&gt;</span><br><span class="line">		&lt;/Console&gt;</span><br><span class="line">	&lt;/appenders&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;loggers&gt;</span><br><span class="line">		&lt;logger name=&quot;com.roncoo.education&quot; level=&quot;debug&quot; /&gt;</span><br><span class="line">		&lt;root level=&quot;info&quot;&gt;</span><br><span class="line">			&lt;appenderref ref=&quot;CONSOLE&quot; /&gt;</span><br><span class="line">		&lt;/root&gt;</span><br><span class="line">	&lt;/loggers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>支持自定义applicatoin.properties配置logging.config=classpath:log4j2-dev.xml 为resources/log4j2-dev.xml</p>
<h2 id="logback"><a href="#logback" class="headerlink" title="logback"></a>logback</h2><p>添加/resources/logback-spring.xml默认读取不同环境.取决于application.properties的配置spring.profiles.active=dev<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;!-- 文件输出格式 --&gt;</span><br><span class="line">	&lt;property name=&quot;PATTERN&quot; value=&quot;%-12(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;) |-%-5level [%thread] %c [%L] -| %msg%n&quot; /&gt;</span><br><span class="line">	&lt;!-- test文件路径 --&gt;</span><br><span class="line">	&lt;property name=&quot;TEST_FILE_PATH&quot; value=&quot;c:/opt/roncoo/logs&quot; /&gt;</span><br><span class="line">	&lt;!-- pro文件路径 --&gt;</span><br><span class="line">	&lt;property name=&quot;PRO_FILE_PATH&quot; value=&quot;/opt/roncoo/logs&quot; /&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 开发环境 --&gt;</span><br><span class="line">	&lt;springProfile name=&quot;dev&quot;&gt;</span><br><span class="line">		&lt;appender name=&quot;CONSOLE&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">			&lt;encoder&gt;</span><br><span class="line">				&lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;</span><br><span class="line">			&lt;/encoder&gt;</span><br><span class="line">		&lt;/appender&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;logger name=&quot;com.roncoo.education&quot; level=&quot;debug&quot;/&gt;</span><br><span class="line"></span><br><span class="line">		&lt;root level=&quot;info&quot;&gt;</span><br><span class="line">			&lt;appender-ref ref=&quot;CONSOLE&quot; /&gt;</span><br><span class="line">		&lt;/root&gt;</span><br><span class="line">	&lt;/springProfile&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 测试环境 --&gt;</span><br><span class="line">	&lt;springProfile name=&quot;test&quot;&gt;</span><br><span class="line">		&lt;!-- 每天产生一个文件 --&gt;</span><br><span class="line">		&lt;appender name=&quot;TEST-FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">			&lt;!-- 文件路径 --&gt;</span><br><span class="line">			&lt;file&gt;$&#123;TEST_FILE_PATH&#125;&lt;/file&gt;</span><br><span class="line">			&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">				&lt;!-- 文件名称 --&gt;</span><br><span class="line">				&lt;fileNamePattern&gt;$&#123;TEST_FILE_PATH&#125;/info.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;</span><br><span class="line">				&lt;!-- 文件最大保存历史数量 --&gt;</span><br><span class="line">				&lt;MaxHistory&gt;100&lt;/MaxHistory&gt;</span><br><span class="line">			&lt;/rollingPolicy&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;</span><br><span class="line">				&lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;</span><br><span class="line">			&lt;/layout&gt;</span><br><span class="line">		&lt;/appender&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;root level=&quot;info&quot;&gt;</span><br><span class="line">			&lt;appender-ref ref=&quot;TEST-FILE&quot; /&gt;</span><br><span class="line">		&lt;/root&gt;</span><br><span class="line">	&lt;/springProfile&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- 生产环境 --&gt;</span><br><span class="line">	&lt;springProfile name=&quot;prod&quot;&gt;</span><br><span class="line">		&lt;appender name=&quot;PROD_FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;</span><br><span class="line">			&lt;file&gt;$&#123;PRO_FILE_PATH&#125;&lt;/file&gt;</span><br><span class="line">			&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;</span><br><span class="line">				&lt;fileNamePattern&gt;$&#123;PRO_FILE_PATH&#125;/warn.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;</span><br><span class="line">				&lt;MaxHistory&gt;100&lt;/MaxHistory&gt;</span><br><span class="line">			&lt;/rollingPolicy&gt;</span><br><span class="line">			&lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;</span><br><span class="line">				&lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;</span><br><span class="line">			&lt;/layout&gt;</span><br><span class="line">		&lt;/appender&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;root level=&quot;warn&quot;&gt;</span><br><span class="line">			&lt;appender-ref ref=&quot;PROD_FILE&quot; /&gt;</span><br><span class="line">		&lt;/root&gt;</span><br><span class="line">	&lt;/springProfile&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>支持重命名为logback-roncoo.xml，需要在application.properties配置logging.config=classpath:logback-roncoo.xml</p>
<h1 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h1><p>Freemarker,Thymeleaf,Velocity,Grovvy,Mustache<br>jsp尽量避免：只能打包为war，不支持jar，只能在tomcat,jetty,内嵌的jetty不支持jsp，jsp自定义错误页面不能覆盖Spring boot默认的错误页面</p>
<h2 id="Freemarker"><a href="#Freemarker" class="headerlink" title="Freemarker"></a>Freemarker</h2><p>添加pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.4.0.RELEASE&lt;/version&gt;</span><br><span class="line">  &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jquery&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.1.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">  &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>搭建Controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(value = &quot;/web&quot;)</span><br><span class="line">public class WebController &#123;</span><br><span class="line">	private static final Logger logger = LoggerFactory.getLogger(WebController.class);</span><br><span class="line">	@RequestMapping(value = &quot;index&quot;)</span><br><span class="line">	public String index(ModelMap map) &#123;</span><br><span class="line">		logger.info(&quot;你好啊世界&quot;);</span><br><span class="line">		map.put(&quot;title&quot;, &quot;freemarker hello word&quot;);</span><br><span class="line">		return &quot;index&quot;; // 开头不要加上/，linux下面会出错</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建静态文件/resources/templates/index.ftl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">	&lt;img src=&quot;/images/logo.png&quot; /&gt;		将调用/resources/static下的资源</span><br><span class="line">	&lt;h1 id=&quot;title&quot;&gt;$&#123;title&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/webjars/jquery/2.1.4/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$(&apos;#title&apos;).click(function()&#123;</span><br><span class="line">			alert(&apos;点击了&apos;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><p>修改pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jquery&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.1.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">  &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>创建Controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(value = &quot;/web&quot;)</span><br><span class="line">public class WebController &#123;</span><br><span class="line">	@RequestMapping(value = &quot;index&quot;)</span><br><span class="line">	public String index(ModelMap map) &#123;</span><br><span class="line">		map.put(&quot;title&quot;, &quot;thymeleaf hello word&quot;);</span><br><span class="line">		return &quot;index&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建/resources/templates/index.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">	&lt;img src=&quot;/images/logo.png&quot; /&gt;				将调用/resources/static下的资源</span><br><span class="line">	&lt;h1 id=&quot;title&quot; th:text=&quot;$&#123;title&#125;&quot;&gt;&lt;/h1&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/webjars/jquery/2.1.4/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$(&apos;#title&apos;).click(function()&#123;</span><br><span class="line">			alert(&apos;点击了&apos;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><h2 id="实现ErrorController接口"><a href="#实现ErrorController接口" class="headerlink" title="实现ErrorController接口"></a>实现ErrorController接口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(value = &quot;error&quot;)</span><br><span class="line">public class BaseErrorController implements ErrorController &#123;</span><br><span class="line">	private static final Logger logger = LoggerFactory.getLogger(BaseErrorController.class);</span><br><span class="line">	@Override</span><br><span class="line">	public String getErrorPath() &#123;</span><br><span class="line">		logger.info(&quot;出错啦！进入自定义错误控制器&quot;);</span><br><span class="line">		return &quot;comm/error&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	@RequestMapping</span><br><span class="line">	public String error() &#123;</span><br><span class="line">		return getErrorPath();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拦截所有异常并跳转到templates/comm/error.ftl</p>
<h2 id="默认异常处理文件"><a href="#默认异常处理文件" class="headerlink" title="默认异常处理文件"></a>默认异常处理文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(value = &quot;/web&quot;)</span><br><span class="line">public class WebController &#123;</span><br><span class="line">	@RequestMapping(value = &quot;index&quot;)</span><br><span class="line">	public String index(ModelMap map) &#123;</span><br><span class="line">		map.put(&quot;title&quot;, &quot;freemarker hello word&quot;);</span><br><span class="line">		return &quot;index&quot;; // 开头不要加上/，linux下面会出错</span><br><span class="line">	&#125;</span><br><span class="line">	//	http://localhost:8080/web/123默认查找public/error/404.html</span><br><span class="line">	@RequestMapping(value = &quot;error&quot;)	//抛出异常templates/error/5xx.ftl</span><br><span class="line">	public String error(ModelMap map) &#123;</span><br><span class="line">		throw new RuntimeException(&quot;测试异常&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认404页面public/error/404.html，默认模板引擎错误页面templates/error/5xx.ftl</p>
<h2 id="注解处理异常"><a href="#注解处理异常" class="headerlink" title="注解处理异常"></a>注解处理异常</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">@ControllerAdvice</span><br><span class="line">public class ErrorExceptionHandler &#123;</span><br><span class="line">	private static final Logger logger = LoggerFactory.getLogger(ErrorExceptionHandler.class);</span><br><span class="line">	/**</span><br><span class="line">	 * 统一异常处理</span><br><span class="line">	 * </span><br><span class="line">	 * @param exception</span><br><span class="line">	 *            exception</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	@ExceptionHandler(&#123; RuntimeException.class &#125;)//拦截异常类型	</span><br><span class="line">	@ResponseStatus(HttpStatus.OK)</span><br><span class="line">	public ModelAndView processException(RuntimeException exception) &#123;</span><br><span class="line">		logger.info(&quot;自定义异常处理-RuntimeException&quot;);</span><br><span class="line">		ModelAndView m = new ModelAndView();</span><br><span class="line">		m.addObject(&quot;roncooException&quot;, exception.getMessage());</span><br><span class="line">		m.setViewName(&quot;error/500&quot;);//在templates/error/500.ftl &lt;h1&gt;$&#123;roncooException&#125;&lt;/h1&gt;获取异常内容</span><br><span class="line">		return m;</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 统一异常处理</span><br><span class="line">	 * </span><br><span class="line">	 * @param exception</span><br><span class="line">	 *            exception</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	@ExceptionHandler(&#123; Exception.class &#125;)</span><br><span class="line">	@ResponseStatus(HttpStatus.OK)</span><br><span class="line">	public ModelAndView processException(Exception exception) &#123;</span><br><span class="line">		logger.info(&quot;自定义异常处理-Exception&quot;);</span><br><span class="line">		ModelAndView m = new ModelAndView();</span><br><span class="line">		m.addObject(&quot;roncooException&quot;, exception.getMessage());</span><br><span class="line">		m.setViewName(&quot;error/500&quot;);</span><br><span class="line">		return m;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://localhost:8080/web/error" target="_blank" rel="noopener">http://localhost:8080/web/error</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(value = &quot;/web&quot;)</span><br><span class="line">public class WebController &#123;</span><br><span class="line">	@RequestMapping(value = &quot;index&quot;)</span><br><span class="line">	public String index(ModelMap map) &#123;</span><br><span class="line">		map.put(&quot;title&quot;, &quot;freemarker hello word&quot;);</span><br><span class="line">		return &quot;index&quot;; // 开头不要加上/，linux下面会出错</span><br><span class="line">	&#125;</span><br><span class="line">	@RequestMapping(value = &quot;error&quot;)</span><br><span class="line">	public String error(ModelMap map) &#123;</span><br><span class="line">		throw new RuntimeException(&quot;测试异常&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="sevelet-listener-filter"><a href="#sevelet-listener-filter" class="headerlink" title="sevelet,listener,filter"></a>sevelet,listener,filter</h1><h2 id="注册成Bean"><a href="#注册成Bean" class="headerlink" title="注册成Bean"></a>注册成Bean</h2><p>添加pom.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.0.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jquery&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加Servlet类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class CustomServlet extends HttpServlet &#123;</span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line">	@Override</span><br><span class="line">	protected void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		System.out.println(&quot;servlet get method&quot;);</span><br><span class="line">		doPost(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	protected void doPost(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		System.out.println(&quot;servlet post method&quot;);</span><br><span class="line">		response.getWriter().write(&quot;hello world&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>添加listener类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class CustomListener implements ServletContextListener &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void contextInitialized(ServletContextEvent sce) &#123;</span><br><span class="line">		System.out.println(&quot;contextInitialized&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void contextDestroyed(ServletContextEvent sce) &#123;</span><br><span class="line">		System.out.println(&quot;contextDestroyed&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>添加Filter类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class CustomFilter implements Filter &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">		System.out.println(&quot;init filter&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</span><br><span class="line">			throws IOException, ServletException &#123;</span><br><span class="line">		System.out.println(&quot;do filter&quot;);</span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void destroy() &#123;</span><br><span class="line">		System.out.println(&quot;destroy filter&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建主程序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo101Application &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public ServletRegistrationBean servletRegistrationBean() &#123;</span><br><span class="line">		return new ServletRegistrationBean(new CustomServlet(), &quot;/roncoo&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public FilterRegistrationBean filterRegistrationBean() &#123;</span><br><span class="line">		//若没有第二个参数，则拦截所有请求包括静态资源</span><br><span class="line">		return new FilterRegistrationBean(new CustomFilter(), servletRegistrationBean());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public ServletListenerRegistrationBean&lt;CustomListener&gt; servletListenerRegistrationBean() &#123;</span><br><span class="line">		return new ServletListenerRegistrationBean&lt;CustomListener&gt;(new CustomListener());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo101Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ServletContextInitializer直接注册"><a href="#ServletContextInitializer直接注册" class="headerlink" title="ServletContextInitializer直接注册"></a>ServletContextInitializer直接注册</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo102Application implements ServletContextInitializer &#123;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void onStartup(ServletContext servletContext) throws ServletException &#123;</span><br><span class="line">		servletContext.addServlet(&quot;customServlet&quot;, new CustomServlet()).addMapping(&quot;/roncoo&quot;);</span><br><span class="line">		servletContext.addFilter(&quot;customFilter&quot;, new CustomFilter())</span><br><span class="line">				.addMappingForServletNames(EnumSet.of(DispatcherType.REQUEST), true, &quot;customServlet&quot;);</span><br><span class="line">		servletContext.addListener(new CustomListener());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo102Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="注解注册"><a href="#注解注册" class="headerlink" title="注解注册"></a>注解注册</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">@WebFilter(filterName = &quot;customFilter&quot;, urlPatterns = &quot;/*&quot;)</span><br><span class="line">public class CustomFilter implements Filter &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">		System.out.println(&quot;init filter&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</span><br><span class="line">			throws IOException, ServletException &#123;</span><br><span class="line">		System.out.println(&quot;do filter&quot;);</span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void destroy() &#123;</span><br><span class="line">		System.out.println(&quot;destroy filter&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">@WebListener</span><br><span class="line">public class CustomListener implements ServletContextListener &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void contextInitialized(ServletContextEvent sce) &#123;</span><br><span class="line">		System.out.println(&quot;contextInitialized&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void contextDestroyed(ServletContextEvent sce) &#123;</span><br><span class="line">		System.out.println(&quot;contextDestroyed&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">@WebServlet(name = &quot;customServlet&quot;, urlPatterns = &quot;/roncoo&quot;)</span><br><span class="line">public class CustomServlet extends HttpServlet &#123;</span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		System.out.println(&quot;servlet get method&quot;);</span><br><span class="line">		doPost(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	protected void doPost(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">			throws ServletException, IOException &#123;</span><br><span class="line">		System.out.println(&quot;servlet post method&quot;);</span><br><span class="line">		response.getWriter().write(&quot;hello world&quot;);</span><br><span class="line">		response.flushBuffer();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">主程序</span><br><span class="line">@ServletComponentScan</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo103Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo103Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h2><p>spring.profiles.active=test修改环境配置设置端口8081，并启动<br>跨域配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class CustomCorsConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public WebMvcConfigurer corsConfigurer() &#123;</span><br><span class="line">		return new WebMvcConfigurerAdapter() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">				// 限制了路径和域名的访问</span><br><span class="line">				registry.addMapping(&quot;/api/**&quot;).allowedOrigins(&quot;http://localhost:8080&quot;);//取消allowedOrigins则任意路径域名都可以访问</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">或者</span><br><span class="line">@Configuration</span><br><span class="line">public class CustomCorsConfiguration2 extends WebMvcConfigurerAdapter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">        registry.addMapping(&quot;/api/**&quot;).allowedOrigins(&quot;http://localhost:8080&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建api的controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/api&quot;)</span><br><span class="line">public class ApiController &#123;</span><br><span class="line">	@RequestMapping(value = &quot;/get&quot;)</span><br><span class="line">	public HashMap&lt;String, Object&gt; get(@RequestParam String name) &#123;</span><br><span class="line">		HashMap&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		map.put(&quot;title&quot;, &quot;hello world&quot;);</span><br><span class="line">		map.put(&quot;name&quot;, name);</span><br><span class="line">		return map;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在8080端口启动另一个程序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(&apos;#title&apos;).click(function()&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: &quot;http://localhost:8081/api/get&quot;,</span><br><span class="line">        type: &quot;POST&quot;,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: &quot;测试&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        success: function(data, status, xhr) &#123;</span><br><span class="line">            console.log(data);</span><br><span class="line">            alert(data.name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="细粒度注解"><a href="#细粒度注解" class="headerlink" title="细粒度注解"></a>细粒度注解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/api&quot;, method = RequestMethod.POST)</span><br><span class="line">public class ApiController &#123;</span><br><span class="line">	@CrossOrigin(origins = &quot;http://localhost:8080&quot;) //需要jdk和java语言级别调成1.8</span><br><span class="line">	@RequestMapping(value = &quot;/get&quot;)</span><br><span class="line">	public HashMap&lt;String, Object&gt; get(@RequestParam String name) &#123;</span><br><span class="line">		HashMap&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		map.put(&quot;title&quot;, &quot;hello world&quot;);</span><br><span class="line">		map.put(&quot;name&quot;, name);</span><br><span class="line">		return map;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">语言调为1.8 需要配置</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">	&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">	&lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</span><br><span class="line">	&lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><p>创建跳转Controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(value = &quot;/web&quot;)</span><br><span class="line">public class WebController &#123;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(value = &quot;index&quot;)</span><br><span class="line">	public String index(ModelMap map) &#123;</span><br><span class="line">		map.put(&quot;title&quot;, &quot;freemarker hello word&quot;);</span><br><span class="line">		return &quot;index&quot;; // 开头不要加上/，linux下面会出错</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建上传controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(value = &quot;/file&quot;)</span><br><span class="line">public class FileController &#123;</span><br><span class="line">	private static final Logger logger = LoggerFactory.getLogger(FileController.class);</span><br><span class="line">	@RequestMapping(value = &quot;upload&quot;)</span><br><span class="line">	@ResponseBody</span><br><span class="line">	public String upload(@RequestParam(&quot;roncooFile&quot;) MultipartFile file) &#123;</span><br><span class="line">		if (file.isEmpty()) &#123;</span><br><span class="line">			return &quot;文件为空&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		// 获取文件名</span><br><span class="line">		String fileName = file.getOriginalFilename();</span><br><span class="line">		logger.info(&quot;上传的文件名为：&quot; + fileName);</span><br><span class="line">		// 获取文件的后缀名</span><br><span class="line">		String suffixName = fileName.substring(fileName.lastIndexOf(&quot;.&quot;));</span><br><span class="line">		logger.info(&quot;上传的后缀名为：&quot; + suffixName);</span><br><span class="line">		// 文件上传路径</span><br><span class="line">		String filePath = &quot;d:/&quot;;</span><br><span class="line">		// 解决中文问题，liunx下中文路径，图片显示问题</span><br><span class="line">		 fileName = UUID.randomUUID() + suffixName;</span><br><span class="line">		File dest = new File(filePath + fileName);</span><br><span class="line">		// 检测是否存在目录</span><br><span class="line">		if (!dest.getParentFile().exists()) &#123;</span><br><span class="line">			dest.getParentFile().mkdirs();</span><br><span class="line">		&#125;</span><br><span class="line">		try &#123;</span><br><span class="line">			file.transferTo(dest);</span><br><span class="line">			return &quot;上传成功&quot;;</span><br><span class="line">		&#125; catch (IllegalStateException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		return &quot;上传失败&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建页面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">	&lt;img src=&quot;/images/logo.png&quot; /&gt;</span><br><span class="line">	&lt;h1 id=&quot;title&quot;&gt;$&#123;title&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">&lt;form method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot; action=&quot;/file/upload&quot;&gt; </span><br><span class="line">   	文件：&lt;input type=&quot;file&quot; name=&quot;roncooFile&quot; /&gt;</span><br><span class="line">   &lt;input type=&quot;submit&quot; value=&quot;上传&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/webjars/jquery/2.1.4/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$(&apos;#title&apos;).click(function()&#123;</span><br><span class="line">			alert(&apos;点击了&apos;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>配置上传参数application.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.http.multipart.max-file-size=2Mb</span><br><span class="line">spring.http.multipart.max-request-size=10Mb</span><br><span class="line">spring.http.multipart.enabled=true</span><br><span class="line">spring.http.multipart.file-size-threshold=0</span><br><span class="line">spring.http.multipart.location=C:/</span><br></pre></td></tr></table></figure></p>
<h1 id="集成JdbcTemplate"><a href="#集成JdbcTemplate" class="headerlink" title="集成JdbcTemplate"></a>集成JdbcTemplate</h1><p>添加依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jquery&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- 数据库 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;!--&lt;scope&gt;runtime&lt;/scope&gt;--&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>修改配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#主配置文件，配置了这个会优先读取里面的属性覆盖主配置文件的属性</span><br><span class="line">spring.profiles.active=dev</span><br><span class="line"># 应用自定义配置</span><br><span class="line">logging.config=classpath:logback-roncoo.xml</span><br><span class="line">#端口配置</span><br><span class="line">server.port=8080</span><br><span class="line"></span><br><span class="line">#数据库连接配置</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost/test?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br><span class="line"></span><br><span class="line">&lt;!-- 开发环境 --&gt;</span><br><span class="line">&lt;springProfile name=&quot;dev&quot;&gt;</span><br><span class="line">	&lt;appender name=&quot;CONSOLE&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">	&lt;logger name=&quot;com.roncoo.education&quot; level=&quot;debug&quot;/&gt;</span><br><span class="line">	&lt;logger name=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; level=&quot;debug&quot;/&gt;&lt;!--打印日志--&gt;</span><br><span class="line"></span><br><span class="line">	&lt;root level=&quot;info&quot;&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;CONSOLE&quot; /&gt;</span><br><span class="line">	&lt;/root&gt;</span><br><span class="line">&lt;/springProfile&gt;</span><br></pre></td></tr></table></figure></p>
<p>Dao层<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface RoncooUserDao &#123;</span><br><span class="line">	int insert(RoncooUser roncooUser);</span><br><span class="line">	int deleteById(int id);</span><br><span class="line">	int updateById(RoncooUser roncooUser);</span><br><span class="line">	RoncooUser selectById(int id);</span><br><span class="line">	Page&lt;RoncooUser&gt; queryForPage(int pageCurrent, int pageSize, String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>实现类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@Repository</span><br><span class="line">public class RoncooUserDaoImpl extends JdbcDaoImpl implements RoncooUserDao &#123;</span><br><span class="line"></span><br><span class="line">	public int insert(RoncooUser roncooUser) &#123;</span><br><span class="line">		String sql = &quot;insert into roncoo_user (name, create_time) values (?, ?)&quot;;</span><br><span class="line">		return jdbcTemplate.update(sql, roncooUser.getName(), roncooUser.getCreateTime());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public int deleteById(int id) &#123;</span><br><span class="line">		String sql = &quot;delete from roncoo_user where id=?&quot;;</span><br><span class="line">		return jdbcTemplate.update(sql, id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public int updateById(RoncooUser roncooUser) &#123;</span><br><span class="line">		String sql = &quot;update roncoo_user set name=?, create_time=? where id=?&quot;;</span><br><span class="line">		return jdbcTemplate.update(sql, roncooUser.getName(), roncooUser.getCreateTime(), roncooUser.getId());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public RoncooUser selectById(int id) &#123;</span><br><span class="line">		String sql = &quot;select * from roncoo_user where id=?&quot;;		</span><br><span class="line">		return queryForObject(sql, RoncooUser.class, id);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public Page&lt;RoncooUser&gt; queryForPage(int pageCurrent, int pageSize, String name)&#123;</span><br><span class="line">		// 若要like查询，如下</span><br><span class="line">		StringBuffer sql = new StringBuffer(&quot;select * from roncoo_user where 1&quot;);</span><br><span class="line">		if(!StringUtils.isNullOrEmpty(name))&#123;</span><br><span class="line">			// Sql.checkSql 的作用是防止sql注入</span><br><span class="line">			sql.append(&quot; and name like &apos;%&quot;).append(Sql.checkSql(name)).append(&quot;%&apos; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		return queryForPage(sql.toString(), pageCurrent, pageSize, RoncooUser.class);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>工具类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">public class Page&lt;T&gt; implements Serializable &#123;</span><br><span class="line">	private static final long serialVersionUID = -5764853545343945831L;</span><br><span class="line">	public static final int DEFAULT_PAGE_SIZE = 20;</span><br><span class="line">	public static final int MAX_PAGE_SIZE = 1000;</span><br><span class="line">	private List&lt;T&gt; list;</span><br><span class="line">	private int totalCount;</span><br><span class="line">	private int totalPage;</span><br><span class="line">	private int pageCurrent;</span><br><span class="line">	private int pageSize;</span><br><span class="line">	private String orderField;</span><br><span class="line">	private String orderDirection;</span><br><span class="line">	public Page() &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	public Page(int totalCount, int totalPage, int pageCurrent, int pageSize, List&lt;T&gt; list) &#123;</span><br><span class="line">		this.totalCount = totalCount;</span><br><span class="line">		this.totalPage = totalPage;</span><br><span class="line">		this.pageCurrent = pageCurrent;</span><br><span class="line">		this.pageSize = pageSize;</span><br><span class="line">		this.list = list;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;	</span><br><span class="line">public class Sql &#123;</span><br><span class="line">	private Sql() &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 检测sql，防止sql注入</span><br><span class="line">	 */</span><br><span class="line">	public static String checkSql(String sql) &#123;</span><br><span class="line">		String inj_str = &quot;&apos;|and|exec|insert|select|delete|update|count|*|%|chr|mid|master|truncate|char|declare|;|or|-|+|,&quot;;</span><br><span class="line">		String inj_stra[] = inj_str.split(&quot;\\|&quot;);</span><br><span class="line">		for (int i = 0; i &lt; inj_stra.length; i++) &#123;</span><br><span class="line">			if (sql.indexOf(inj_stra[i]) &gt;= 0) &#123;</span><br><span class="line">				return &quot;&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return sql;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 计算总页数</span><br><span class="line">	 */</span><br><span class="line">	public static int countTotalPage(final int totalCount, final int pageSize) &#123;</span><br><span class="line">		if (totalCount % pageSize == 0) &#123;</span><br><span class="line">			return totalCount / pageSize; // 刚好整除</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return totalCount / pageSize + 1; // 不能整除则总页数为：商 + 1</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 校验当前页数pageCurrent&lt;br/&gt;</span><br><span class="line">	 * 1、先根据总记录数totalCount和每页记录数pageSize，计算出总页数totalPage&lt;br/&gt;</span><br><span class="line">	 * 2、判断页面提交过来的当前页数pageCurrent是否大于总页数totalPage，大于则返回totalPage&lt;br/&gt;</span><br><span class="line">	 * 3、判断pageCurrent是否小于1，小于则返回1&lt;br/&gt;</span><br><span class="line">	 * 4、其它则直接返回pageCurrent</span><br><span class="line">	 */</span><br><span class="line">	public static int checkPageCurrent(int totalCount, int pageSize, int pageCurrent) &#123;</span><br><span class="line">		int totalPage = countTotalPage(totalCount, pageSize); // 最大页数</span><br><span class="line">		if (pageCurrent &gt; totalPage) &#123;</span><br><span class="line">			// 如果页面提交过来的页数大于总页数，则将当前页设为总页数</span><br><span class="line">			// 此时要求totalPage要大于获等于1</span><br><span class="line">			if (totalPage &lt; 1) &#123;</span><br><span class="line">				return 1;</span><br><span class="line">			&#125;</span><br><span class="line">			return totalPage;</span><br><span class="line">		&#125; else if (pageCurrent &lt; 1) &#123;</span><br><span class="line">			return 1; // 当前页不能小于1（避免页面输入不正确值）</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return pageCurrent;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 校验页面输入的每页记录数pageSize是否合法&lt;br/&gt;</span><br><span class="line">	 * 1、当页面输入的每页记录数pageSize大于允许的最大每页记录数MAX_PAGE_SIZE时，返回MAX_PAGE_SIZE</span><br><span class="line">	 * 2、如果pageSize小于1，则返回默认的每页记录数DEFAULT_PAGE_SIZE</span><br><span class="line">	 */</span><br><span class="line">	public static int checkPageSize(int pageSize) &#123;</span><br><span class="line">		if (pageSize &gt; Page.MAX_PAGE_SIZE) &#123;</span><br><span class="line">			return Page.MAX_PAGE_SIZE;</span><br><span class="line">		&#125; else if (pageSize &lt; 1) &#123;</span><br><span class="line">			return Page.DEFAULT_PAGE_SIZE;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return pageSize;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 计算当前分页的开始记录的索引</span><br><span class="line">	 */</span><br><span class="line">	public static int countOffset(final int pageCurrent, final int pageSize) &#123;</span><br><span class="line">		return (pageCurrent - 1) * pageSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 根据总记录数，对页面传来的分页参数进行校验，并返分页的SQL语句</span><br><span class="line">	 */</span><br><span class="line">	public static String limitSql(int totalCount, int pageCurrent, int pageSize) &#123;</span><br><span class="line">		// 校验当前页数</span><br><span class="line">		pageCurrent = checkPageCurrent(totalCount, pageSize, pageCurrent);</span><br><span class="line">		pageSize = checkPageSize(pageSize); // 校验每页记录数</span><br><span class="line">		return &quot; limit &quot; + countOffset(pageCurrent, pageSize) + &quot;,&quot; + pageSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 根据分页查询的SQL语句，获取统计总记录数的语句</span><br><span class="line">	 */</span><br><span class="line">	public static String countSql(String sql) &#123;</span><br><span class="line">		String countSql = sql.substring(sql.toLowerCase().indexOf(&quot;from&quot;)); // 去除第一个from前的内容</span><br><span class="line">		return &quot;select count(*) &quot; + removeOrderBy(countSql);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 移除SQL语句中的的order by子句（用于分页前获取总记录数，不需要排序）</span><br><span class="line">	 */</span><br><span class="line">	private static String removeOrderBy(String sql) &#123;</span><br><span class="line">		Pattern pat = Pattern.compile(&quot;order\\s*by[\\w|\\W|\\s|\\S]*&quot;, Pattern.CASE_INSENSITIVE);</span><br><span class="line">		Matcher mc = pat.matcher(sql);</span><br><span class="line">		StringBuffer strBuf = new StringBuffer();</span><br><span class="line">		while (mc.find()) &#123;</span><br><span class="line">			mc.appendReplacement(strBuf, &quot;&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		mc.appendTail(strBuf);</span><br><span class="line">		return strBuf.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">public abstract class JdbcDaoImpl &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	protected JdbcTemplate jdbcTemplate;</span><br><span class="line">	/**</span><br><span class="line">	 * 获取当前事务最后一次更新的主键值</span><br><span class="line">	 */</span><br><span class="line">	public Long getLastId() &#123;</span><br><span class="line">		return jdbcTemplate.queryForObject(&quot;select last_insert_id() as id&quot;, Long.class);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 获取对象信息</span><br><span class="line">	 */</span><br><span class="line">	public &lt;T&gt; T queryForObject(String sql, Class&lt;T&gt; clazz, Object... args) &#123;</span><br><span class="line">		Assert.hasText(sql, &quot;sql 语句不能为空&quot;);</span><br><span class="line">		return jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;T&gt;(clazz), args);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 获取对象集合信息</span><br><span class="line">	 */</span><br><span class="line">	public &lt;T&gt; List&lt;T&gt; queryForObjectList(String sql, Class&lt;T&gt; clazz, Object... args) &#123;</span><br><span class="line">		Assert.hasText(sql, &quot;sql 语句不能为空&quot;);</span><br><span class="line">		return jdbcTemplate.query(sql, args, new BeanPropertyRowMapper&lt;T&gt;(clazz));</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 分页，jdbcTemplate 不支持like</span><br><span class="line">	 */</span><br><span class="line">	public Page&lt;Map&lt;String, Object&gt;&gt; queryForPage(String sql, int pageCurrent, int pageSize, Object... args) &#123;</span><br><span class="line">		Assert.hasText(sql, &quot;sql 语句不能为空&quot;);</span><br><span class="line">		Assert.isTrue(pageCurrent &gt;= 1, &quot;pageNo 必须大于等于1&quot;);</span><br><span class="line">		String sqlCount = Sql.countSql(sql);</span><br><span class="line">		int count = jdbcTemplate.queryForObject(sqlCount, Integer.class, args);</span><br><span class="line">		pageCurrent = Sql.checkPageCurrent(count, pageSize, pageCurrent);</span><br><span class="line">		pageSize = Sql.checkPageSize(pageSize);</span><br><span class="line">		int totalPage = Sql.countTotalPage(count, pageSize);</span><br><span class="line">		String sqlList = sql + Sql.limitSql(count, pageCurrent, pageSize);</span><br><span class="line">		List&lt;Map&lt;String, Object&gt;&gt; list = jdbcTemplate.queryForList(sqlList, args);</span><br><span class="line">		return new Page&lt;Map&lt;String, Object&gt;&gt;(count, totalPage, pageCurrent, pageSize, list);</span><br><span class="line">	&#125;</span><br><span class="line">	/**</span><br><span class="line">	 * 分页，jdbcTemplate 不支持like</span><br><span class="line">	 */</span><br><span class="line">	public &lt;T&gt; Page&lt;T&gt; queryForPage(String sql, int pageCurrent, int pageSize, Class&lt;T&gt; clazz, Object... args) &#123;</span><br><span class="line">		Assert.hasText(sql, &quot;sql 语句不能为空&quot;);</span><br><span class="line">		Assert.isTrue(pageCurrent &gt;= 1, &quot;pageNo 必须大于等于1&quot;);</span><br><span class="line">		Assert.isTrue(clazz != null, &quot;clazz 不能为空&quot;);</span><br><span class="line">		String sqlCount = Sql.countSql(sql);</span><br><span class="line">		int count = jdbcTemplate.queryForObject(sqlCount, Integer.class, args);</span><br><span class="line">		pageCurrent = Sql.checkPageCurrent(count, pageSize, pageCurrent);</span><br><span class="line">		pageSize = Sql.checkPageSize(pageSize);</span><br><span class="line">		int totalPage = Sql.countTotalPage(count, pageSize);</span><br><span class="line">		String sqlList = sql + Sql.limitSql(count, pageCurrent, pageSize);</span><br><span class="line">		List&lt;T&gt; list = jdbcTemplate.query(sqlList, new BeanPropertyRowMapper&lt;T&gt;(clazz), args);</span><br><span class="line">		return new Page&lt;T&gt;(count, totalPage, pageCurrent, pageSize, list);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo131ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserDao roncooUserDao;</span><br><span class="line">	@Test</span><br><span class="line">	public void insert() &#123;</span><br><span class="line">		RoncooUser roncooUser = new RoncooUser();</span><br><span class="line">		roncooUser.setName(&quot;测试&quot;);</span><br><span class="line">		roncooUser.setCreateTime(new Date());</span><br><span class="line">		int result = roncooUserDao.insert(roncooUser);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void delete() &#123;</span><br><span class="line">		int result = roncooUserDao.deleteById(1);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void update() &#123;</span><br><span class="line">		RoncooUser roncooUser = new RoncooUser();</span><br><span class="line">		roncooUser.setId(1);</span><br><span class="line">		roncooUser.setName(&quot;测试2&quot;);</span><br><span class="line">		roncooUser.setCreateTime(new Date());</span><br><span class="line">		int result = roncooUserDao.updateById(roncooUser);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void select() &#123;</span><br><span class="line">		RoncooUser result = roncooUserDao.selectById(1);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void select2() &#123;</span><br><span class="line">		RoncooUser result = roncooUserDao.selectById(7);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	// 分页测试</span><br><span class="line">	@Test</span><br><span class="line">	public void queryForPage()&#123;</span><br><span class="line">		Page&lt;RoncooUser&gt; result = roncooUserDao.queryForPage(1, 20, &quot;测试&quot;);</span><br><span class="line">		System.out.println(result.getList());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="springboot-data-jpa"><a href="#springboot-data-jpa" class="headerlink" title="springboot_data_jpa"></a>springboot_data_jpa</h1><table>
<thead>
<tr>
<th>Keyword</th>
<th>Sample</th>
<th>JPQL snippet</th>
</tr>
</thead>
<tbody>
<tr>
<td>And</td>
<td>findByLastnameAndFirstname</td>
<td>… where x.lastname = ?1 and x.firstname = ?2</td>
</tr>
<tr>
<td>Or</td>
<td>findByLastnameOrFirstname</td>
<td>… where x.lastname = ?1 or x.firstname = ?2</td>
</tr>
<tr>
<td>Is,Equals</td>
<td>findByFirstname,findByFirstnameIs,findByFirstnameEquals</td>
<td>… where x.firstname = ?1</td>
</tr>
<tr>
<td>Between</td>
<td>findByStartDateBetween</td>
<td>… where x.startDate between ?1 and ?2</td>
</tr>
<tr>
<td>LessThan</td>
<td>findByAgeLessThan</td>
<td>… where x.age &lt; ?1</td>
</tr>
<tr>
<td>LessThanEqual</td>
<td>findByAgeLessThanEqual</td>
<td>… where x.age &gt; ?1</td>
</tr>
<tr>
<td>GreaterThan</td>
<td>findByAgeGreaterThan</td>
<td>… where x.age &gt; ?1</td>
</tr>
<tr>
<td>GreaterThanEqual</td>
<td>findByAgeGreaterThanEqual</td>
<td>… where x.age &gt;= ?1</td>
</tr>
<tr>
<td>After</td>
<td>findByStartDateAfter</td>
<td>… where x.startDate &gt; ?1</td>
</tr>
<tr>
<td>Before</td>
<td>findByStartDateBefore</td>
<td>… where x.startDate &lt; ?1</td>
</tr>
<tr>
<td>IsNull</td>
<td>findByAgeIsNull</td>
<td>… where x.age is null</td>
</tr>
<tr>
<td>IsNotNull,NotNull</td>
<td>findByAge(Is)NotNull</td>
<td>… where x.age not null</td>
</tr>
<tr>
<td>Like</td>
<td>findByFirstnameLike</td>
<td>… where x.firstname like ?1</td>
</tr>
<tr>
<td>NotLike</td>
<td>findByFirstnameNotLike</td>
<td>… where x.firstname not like ?1</td>
</tr>
<tr>
<td>StartingWith</td>
<td>findByFirstnameStartingWith</td>
<td>… where x.firstname like ?1(parameter bound with appended %)</td>
</tr>
<tr>
<td>EndingWith</td>
<td>findByFirstnameEndingWith</td>
<td>… where x.firstname like ?1(parameter bound with prepended %)</td>
</tr>
<tr>
<td>Containing</td>
<td>findByFirstnameContaining</td>
<td>… where x.firstname like ?1(parameter bound wrapped in%)</td>
</tr>
<tr>
<td>OrderBy</td>
<td>findByAgeOrderByLastnameDesc</td>
<td>… where x.age = ?1 order by x.lastname desc</td>
</tr>
<tr>
<td>Not</td>
<td>findByLastnameNot</td>
<td>… where x.lastname &lt;&gt; ?1</td>
</tr>
<tr>
<td>In</td>
<td>findByAgeIn(Collection<age> ages)</age></td>
<td>… where x.age in ?1</td>
</tr>
<tr>
<td>NotIn</td>
<td>findByAgeNotIn(Collection<age> age)</age></td>
<td>… where x.age not in ?1</td>
</tr>
<tr>
<td>True</td>
<td>findByActiveTrue()</td>
<td>… where x.active = true</td>
</tr>
<tr>
<td>False</td>
<td>findByActiveFalse()</td>
<td>… where x.active = false</td>
</tr>
<tr>
<td>IgnoreCase</td>
<td>findByFirstnameIgnoreCase</td>
<td>… where UPPER(x.firstame) = UPPER(?1)</td>
</tr>
</tbody>
</table>
<p>添加pom.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jquery&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 数据库 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#主配置文件，配置了这个会优先读取里面的属性覆盖主配置文件的属性</span><br><span class="line">spring.profiles.active=dev</span><br><span class="line"></span><br><span class="line"># 应用自定义配置</span><br><span class="line">logging.config=classpath:logback-roncoo.xml</span><br><span class="line"></span><br><span class="line">#端口配置</span><br><span class="line">server.port=8080</span><br><span class="line">#数据库连接配置</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost/test?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br><span class="line"># JPA</span><br><span class="line">spring.jpa.hibernate.ddl-auto= update</span><br><span class="line">spring.jpa.show-sql=true</span><br></pre></td></tr></table></figure></p>
<p>创建Dao<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface RoncooUserLogDao extends JpaRepository&lt;RoncooUserLog, Integer&gt; &#123;</span><br><span class="line">	@Query(value = &quot;select u from RoncooUserLog u where u.userName=?1&quot;)//优先使用</span><br><span class="line">	List&lt;RoncooUserLog&gt; findByUserName(String userName);</span><br><span class="line">	List&lt;RoncooUserLog&gt; findByUserNameAndUserIp(String string, String string2);</span><br><span class="line">	Page&lt;RoncooUserLog&gt; findByUserName(String userName, Pageable pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建实体类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">public class RoncooUserLog &#123;</span><br><span class="line">	@Id</span><br><span class="line">	@GeneratedValue</span><br><span class="line">	private Integer id;</span><br><span class="line">	@Column</span><br><span class="line">	private Date createTime;</span><br><span class="line">	@Column</span><br><span class="line">	private String userName;</span><br><span class="line">	@Column</span><br><span class="line">	private String userIp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo141ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserLogDao roncooUserLogDao;</span><br><span class="line">	@Test</span><br><span class="line">	public void insert() &#123;//自动建表</span><br><span class="line">		RoncooUserLog entity = new RoncooUserLog();</span><br><span class="line">		entity.setUserName(&quot;无境&quot;);</span><br><span class="line">		entity.setUserIp(&quot;192.168.0.1&quot;);</span><br><span class="line">		entity.setCreateTime(new Date());</span><br><span class="line">		roncooUserLogDao.save(entity);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void delete() &#123;</span><br><span class="line">		roncooUserLogDao.delete(1);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void update() &#123;</span><br><span class="line">		RoncooUserLog entity = new RoncooUserLog();</span><br><span class="line">		entity.setId(2);</span><br><span class="line">		entity.setUserName(&quot;无境2&quot;);</span><br><span class="line">		entity.setUserIp(&quot;192.168.0.1&quot;);</span><br><span class="line">		entity.setCreateTime(new Date());</span><br><span class="line">		roncooUserLogDao.save(entity);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void select() &#123;</span><br><span class="line">		RoncooUserLog result = roncooUserLogDao.findOne(1);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void select2() &#123;</span><br><span class="line">		List&lt;RoncooUserLog&gt; result = roncooUserLogDao.findByUserName(&quot;无境&quot;);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void select3() &#123;</span><br><span class="line">		List&lt;RoncooUserLog&gt; result = roncooUserLogDao.findByUserNameAndUserIp(&quot;无境&quot;, &quot;192.168.0.1&quot;);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	// 分页</span><br><span class="line">	@Test</span><br><span class="line">	public void queryForPage() &#123;</span><br><span class="line">		Pageable pageable = new PageRequest(0, 20, new Sort(new Order(Direction.DESC, &quot;id&quot;)));</span><br><span class="line">		Page&lt;RoncooUserLog&gt; result = roncooUserLogDao.findByUserName(&quot;无境&quot;, pageable);</span><br><span class="line">		Page&lt;RoncooUserLog&gt; result2 = roncooUserLogDao.findAll(pageable);</span><br><span class="line">		System.out.println(result.getContent());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="事务处理"><a href="#事务处理" class="headerlink" title="事务处理"></a>事务处理</h1><h2 id="事务有四个特性：ACID"><a href="#事务有四个特性：ACID" class="headerlink" title="事务有四个特性：ACID"></a>事务有四个特性：ACID</h2><ul>
<li>原子性（Atomicity）：事务是一个原子操作，由一系列动作组成。事务的原子性确保动作要么全部完成，要么完全不起作用。</li>
<li>一致性（Consistency）：一旦事务完成（不管成功还是失败），系统必须确保它所建模的业务处于一致的状态，而不会是部分完成部分失败。在现实中的数据不应该被破坏。</li>
<li>隔离性（Isolation）：可能有许多事务会同时处理相同的数据，因此每个事务都应该与其他事务隔离开来，防止数据损坏。</li>
<li>持久性（Durability）：一旦事务完成，无论发生什么系统错误，它的结果都不应该受到影响，这样就能从任何系统崩溃中恢复过来。通常情况下，事务的结果被写到持久化存储器中。<h2 id="传播行为"><a href="#传播行为" class="headerlink" title="传播行为"></a>传播行为</h2>当事务方法被另一个事务方法调用时，必须指定事务应该如何传播。例如：方法可能继续在现有事务中运行，也可能开启一个新事务，并在自己的事务中运行。<br>Spring 定义了七种传播行为：</li>
<li>PROPAGATION_REQUIRED 表示当前方法必须运行在事务中。如果当前事务存在，方法将会在该事务中运行。否则，会启动一个新的事务，Spring 默认使用</li>
<li>PROPAGATION_SUPPORTS 表示当前方法不需要事务上下文，但是如果存在当前事务的话，那么该方法会在这个事务中运行</li>
<li>PROPAGATION_MANDATORY 表示该方法必须在事务中运行，如果当前事务不存在，则会抛出一个异常</li>
<li>PROPAGATION_REQUIRED_NEW 表示当前方法必须运行在它自己的事务中。一个新的事务将被启动。如果存在当前事务，在该方法执行期间，当前事务会被挂起。如果使用 JTATransactionManager 的话，则需要访问 TransactionManager</li>
<li>PROPAGATION_NOT_SUPPORTED 表示该方法不应该运行在事务中。如果存在当前事务，在该方法运行期间，当前事务将被挂起。如果使用 JTATransactionManager 的话，则需要访问 TransactionManager</li>
<li>PROPAGATION_NEVER 表示当前方法不应该运行在事务上下文中。如果当前正有一个事务在运行，则会抛出异常</li>
<li>PROPAGATION_NESTED 表示如果当前已经存在一个事务，那么该方法将会在嵌套事务中运行。嵌套的事务可以独立于当前事务进行单独地提交或回滚。如果当前事务不存在，那么其行为与</li>
<li>PROPAGATION_REQUIRED 一样。注意各厂商对这种传播行为的支持是有所差异的。可以参考资源管理器的文档来确认它们是否支持嵌套事务<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2>隔离级别定义了一个事务可能受其他并发事务影响的程度。</li>
<li>ISOLATION_DEFAULT 使用后端数据库默认的隔离级别，Spring 默认使用，mysql 默认的隔离级别为：Repeatable Read(可重复读)</li>
<li>ISOLATION_READ_UNCOMMITTED 读未提交，最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读</li>
<li>ISOLATION_READ_COMMITTED 读已提交，允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生</li>
<li>ISOLATION_REPEATABLE_READ 可重复读，对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生</li>
<li>ISOLATION_SERIALIZABLE 可串行化，最高的隔离级别，完全服从 ACID 的隔离级别，确保阻止脏读、不可重复读以及幻读，也是最慢的事务隔离级别，因为它通常是通过完全锁定事务相关的数据库表来实现的</li>
</ul>
<blockquote>
<p>脏读（Dirty reads）——脏读发生在一个事务读取了另一个事务改写但尚未提交的数据时。如果改写再稍后被回滚了，那么第一个事务获取的数据就是无效的。<br>不可重复读（Nonrepeatable read）——不可重复读发生在一个事务执行相同的查询两次或两次以上，但是每次都得到不同的数据时。这通常是因为另一个并发事务在两次查询期间进行了更新。<br>幻读（Phantom read）——幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录。</p>
</blockquote>
<h2 id="属性说明-Transactional"><a href="#属性说明-Transactional" class="headerlink" title="属性说明 @Transactional"></a>属性说明 @Transactional</h2><ul>
<li>isolation：用于指定事务的隔离级别。默认为底层事务的隔离级别。</li>
<li>noRollbackFor：指定遇到指定异常时强制不回滚事务。</li>
<li>noRollbackForClassName：指定遇到指定多个异常时强制不回滚事务。该属性可以指定多个异常类名。</li>
<li>propagation:指定事务的传播属性。</li>
<li>readOnly：指定事务是否只读。表示这个事务只读取数据但不更新数据，这样可以帮助数据库引擎优化事务。若真的是一个只读取的数据库应设置 readOnly=true</li>
<li>rollbackFor：指定遇到指定异常时强制回滚事务。</li>
<li>rollbackForClassName：指定遇到指定多个异常时强制回滚事务。该属性可以指定多个异常类名。</li>
<li>timeout：指定事务的超时时长。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserDao roncooUserDao;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserLogDao roncooUserLogDao;</span><br><span class="line"></span><br><span class="line">	@Transactional</span><br><span class="line">	public String register(String name, String ip) &#123;</span><br><span class="line">		// 1.添加用户</span><br><span class="line">		RoncooUser roncooUser = new RoncooUser();</span><br><span class="line">		roncooUser.setName(name);</span><br><span class="line">		roncooUser.setCreateTime(new Date());</span><br><span class="line">		roncooUserDao.insert(roncooUser);</span><br><span class="line">		// 测试使用</span><br><span class="line">		boolean flag = true;</span><br><span class="line">		if (flag) &#123;</span><br><span class="line">			throw new RuntimeException();</span><br><span class="line">		&#125;</span><br><span class="line">		// 2.添加注册日志</span><br><span class="line">		RoncooUserLog roncooUserLog = new RoncooUserLog();</span><br><span class="line">		roncooUserLog.setUserName(name);</span><br><span class="line">		roncooUserLog.setUserIp(ip);</span><br><span class="line">		roncooUserLog.setCreateTime(new Date());</span><br><span class="line">		roncooUserLogDao.save(roncooUserLog);</span><br><span class="line"></span><br><span class="line">		return &quot;success&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="springboot-h2"><a href="#springboot-h2" class="headerlink" title="springboot_h2"></a>springboot_h2</h1><p><a href="http://localhost:8080/h2-console" target="_blank" rel="noopener">http://localhost:8080/h2-console</a><br>配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#开发环境</span><br><span class="line"></span><br><span class="line">#端口配置</span><br><span class="line">server.port=8080</span><br><span class="line"></span><br><span class="line">#h2</span><br><span class="line">spring.datasource.url=jdbc:h2:~/test;AUTO_SERVER=TRUE;DB_CLOSE_ON_EXIT=FALSE</span><br><span class="line">#spring.datasource.url=jdbc:h2:file:D:/roncoo_h2/roncoo_spring_boot;AUTO_SERVER=TRUE;DB_CLOSE_ON_EXIT=FALSE</span><br><span class="line"># 用这个url时将jdbc:h2:file:D:/roncoo_h2/roncoo_spring_boot登录h2-console,可以自定义username，password缓存到本地</span><br><span class="line">spring.datasource.username=sa</span><br><span class="line">spring.datasource.password=</span><br><span class="line"></span><br><span class="line"># JPA</span><br><span class="line">spring.jpa.hibernate.ddl-auto= update</span><br><span class="line">spring.jpa.show-sql=true</span><br></pre></td></tr></table></figure></p>
<h1 id="配置redis"><a href="#配置redis" class="headerlink" title="配置redis"></a>配置redis</h1><p>添加pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#redis</span><br><span class="line">spring.redis.host=localhost</span><br><span class="line">spring.redis.port=6379</span><br><span class="line">spring.redis.password=123456</span><br><span class="line">spring.redis.database=0</span><br><span class="line">#spring.redis.pool.max-active=8</span><br><span class="line">#spring.redis.pool.max-idle=8</span><br><span class="line">#spring.redis.pool.max-wait=-1</span><br><span class="line">#spring.redis.pool.min-idle=0</span><br><span class="line">#spring.redis.timeout=0</span><br></pre></td></tr></table></figure></p>
<p>创建组件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class RoncooRedisComponent &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private StringRedisTemplate stringRedisTemplate;</span><br><span class="line">	public void set(String key, String value) &#123;</span><br><span class="line">		ValueOperations&lt;String, String&gt; ops = this.stringRedisTemplate.opsForValue();</span><br><span class="line">		if (!this.stringRedisTemplate.hasKey(key)) &#123;</span><br><span class="line">			ops.set(key, value);</span><br><span class="line">			System.out.println(&quot;set key success&quot;);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			// 存在则打印之前的value值</span><br><span class="line">			System.out.println(&quot;this key = &quot; + ops.get(key));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public String get(String key) &#123;</span><br><span class="line">		return this.stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">	&#125;</span><br><span class="line">	public void del(String key) &#123;</span><br><span class="line">		this.stringRedisTemplate.delete(key);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建测试类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo171ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooRedisComponent roncooRedisComponent;</span><br><span class="line">	@Test</span><br><span class="line">	public void set() &#123;</span><br><span class="line">		roncooRedisComponent.set(&quot;roncoo&quot;, &quot;hello world&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void get() &#123;</span><br><span class="line">		System.out.println(roncooRedisComponent.get(&quot;roncoo&quot;));</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void del() &#123;</span><br><span class="line">		roncooRedisComponent.del(&quot;roncoo&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="集成mongodb"><a href="#集成mongodb" class="headerlink" title="集成mongodb"></a>集成mongodb</h1><p>添加依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"> &lt;!--&lt;dependency&gt;--&gt;		首次启动加载比较慢，启动后默认数据会在内存中重启丢失</span><br><span class="line">     &lt;!--&lt;groupId&gt;de.flapdoodle.embed&lt;/groupId&gt;--&gt;</span><br><span class="line">     &lt;!--&lt;artifactId&gt;de.flapdoodle.embed.mongo&lt;/artifactId&gt;--&gt;</span><br><span class="line"> &lt;!--&lt;/dependency&gt;--&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring.data.mongodb.uri=mongodb://localhost/test</span><br><span class="line">spring.data.mongodb.port=27017</span><br><span class="line">#spring.data.mongodb.authentication-database=</span><br><span class="line">#spring.data.mongodb.database=test</span><br><span class="line">#spring.data.mongodb.field-naming-strategy=</span><br><span class="line">#spring.data.mongodb.grid-fs-database=</span><br><span class="line">#spring.data.mongodb.host=localhost</span><br><span class="line">#spring.data.mongodb.password= </span><br><span class="line">#spring.data.mongodb.repositories.enabled=true</span><br><span class="line">#spring.data.mongodb.username=</span><br></pre></td></tr></table></figure></p>
<p>日志配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 开发环境 --&gt;</span><br><span class="line">&lt;springProfile name=&quot;dev&quot;&gt;</span><br><span class="line">	&lt;appender name=&quot;CONSOLE&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">		&lt;encoder&gt;</span><br><span class="line">			&lt;pattern&gt;$&#123;PATTERN&#125;&lt;/pattern&gt;</span><br><span class="line">		&lt;/encoder&gt;</span><br><span class="line">	&lt;/appender&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;logger name=&quot;com.roncoo.education&quot; level=&quot;debug&quot;/&gt;</span><br><span class="line">	&lt;logger name=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; level=&quot;debug&quot;/&gt;</span><br><span class="line">	&lt;logger name=&quot;org.springframework.data.mongodb.core.MongoTemplate&quot; level=&quot;debug&quot;/&gt;</span><br><span class="line"></span><br><span class="line">	&lt;root level=&quot;info&quot;&gt;</span><br><span class="line">		&lt;appender-ref ref=&quot;CONSOLE&quot; /&gt;</span><br><span class="line">	&lt;/root&gt;</span><br><span class="line">&lt;/springProfile&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="方法MongoTemplate"><a href="#方法MongoTemplate" class="headerlink" title="方法MongoTemplate"></a>方法MongoTemplate</h2><p>创建component<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class RoncooMongodbComponent &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private MongoTemplate mongoTemplate;</span><br><span class="line">	public void insert(RoncooUser roncooUser) &#123;</span><br><span class="line">		mongoTemplate.insert(roncooUser);</span><br><span class="line">	&#125;</span><br><span class="line">	public void deleteById(int id) &#123;</span><br><span class="line">		Criteria criteria = Criteria.where(&quot;id&quot;).in(id);</span><br><span class="line">		Query query = new Query(criteria);</span><br><span class="line">		mongoTemplate.remove(query, RoncooUser.class);</span><br><span class="line">	&#125;</span><br><span class="line">	public void updateById(RoncooUser roncooUser) &#123;</span><br><span class="line">		Criteria criteria = Criteria.where(&quot;id&quot;).in(roncooUser.getId());</span><br><span class="line">		Query query = new Query(criteria);</span><br><span class="line">		Update update = new Update();</span><br><span class="line">		update.set(&quot;name&quot;, roncooUser.getName());</span><br><span class="line">		update.set(&quot;createTime&quot;, roncooUser.getCreateTime());</span><br><span class="line">		mongoTemplate.updateMulti(query, update, RoncooUser.class);</span><br><span class="line">	&#125;</span><br><span class="line">	public RoncooUser selectById(int id) &#123;</span><br><span class="line">		Criteria criteria = Criteria.where(&quot;id&quot;).in(id);</span><br><span class="line">		Query query = new Query(criteria);</span><br><span class="line">		return mongoTemplate.findOne(query, RoncooUser.class);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>添加测试类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private RoncooMongodbComponent roncooMongodbComponent;</span><br><span class="line">@Test</span><br><span class="line">public void set() &#123;</span><br><span class="line">	RoncooUser roncooUser = new RoncooUser();</span><br><span class="line">	roncooUser.setId(1);</span><br><span class="line">	roncooUser.setName(&quot;无境1&quot;);</span><br><span class="line">	roncooUser.setCreateTime(new Date());</span><br><span class="line">	roncooMongodbComponent.insert(roncooUser);</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void select() &#123;</span><br><span class="line">	System.out.println(roncooMongodbComponent.selectById(1));</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void update() &#123;</span><br><span class="line">	RoncooUser roncooUser = new RoncooUser();</span><br><span class="line">	roncooUser.setId(1);</span><br><span class="line">	roncooUser.setName(&quot;测试修改&quot;);</span><br><span class="line">	roncooUser.setCreateTime(new Date());</span><br><span class="line">	roncooMongodbComponent.updateById(roncooUser);</span><br><span class="line">	System.out.println(roncooMongodbComponent.selectById(1));</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void delete() &#123;</span><br><span class="line">	roncooMongodbComponent.deleteById(1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="方法MongoRepository"><a href="#方法MongoRepository" class="headerlink" title="方法MongoRepository"></a>方法MongoRepository</h2><p>创建Dao<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface RoncooUserLogMongoDao extends MongoRepository&lt;RoncooUserLog, Integer&gt;&#123;</span><br><span class="line">	RoncooUserLog findByUserName(String string);</span><br><span class="line">	RoncooUserLog findByUserNameAndUserIp(String string, String ip);</span><br><span class="line">	Page&lt;RoncooUserLog&gt; findByUserName(String string, Pageable pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>添加测试类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private RoncooUserLogMongoDao roncooUserLogMongoDao;</span><br><span class="line">@Test</span><br><span class="line">public void insert() &#123;</span><br><span class="line">	RoncooUserLog entity = new RoncooUserLog();</span><br><span class="line">	entity.setId(1);</span><br><span class="line">	entity.setUserName(&quot;无境&quot;);</span><br><span class="line">	entity.setUserIp(&quot;192.168.0.1&quot;);</span><br><span class="line">	entity.setCreateTime(new Date());</span><br><span class="line">	roncooUserLogMongoDao.save(entity);</span><br><span class="line">	System.out.println(roncooUserLogMongoDao.findOne(1));</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void delete() &#123;</span><br><span class="line">	roncooUserLogMongoDao.delete(1);</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void update() &#123;</span><br><span class="line">	RoncooUserLog entity = new RoncooUserLog();</span><br><span class="line">	entity.setId(2);</span><br><span class="line">	entity.setUserName(&quot;无境2&quot;);</span><br><span class="line">	entity.setUserIp(&quot;192.168.0.1&quot;);</span><br><span class="line">	entity.setCreateTime(new Date());</span><br><span class="line">	roncooUserLogMongoDao.save(entity);</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void select() &#123;</span><br><span class="line">	RoncooUserLog result = roncooUserLogMongoDao.findOne(1);</span><br><span class="line">	System.out.println(result);</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void select2() &#123;</span><br><span class="line">	RoncooUserLog result = roncooUserLogMongoDao.findByUserName(&quot;无境2&quot;);</span><br><span class="line">	System.out.println(result);</span><br><span class="line">&#125;</span><br><span class="line">// 分页</span><br><span class="line">@Test</span><br><span class="line">public void queryForPage() &#123;</span><br><span class="line">	Pageable pageable = new PageRequest(0, 20, new Sort(new Order(Direction.DESC, &quot;id&quot;)));</span><br><span class="line">	// Page&lt;RoncooUserLog&gt; result = roncooUserLogDao.findByUserName(&quot;无境2&quot;, pageable);</span><br><span class="line">	Page&lt;RoncooUserLog&gt; result = roncooUserLogMongoDao.findAll(pageable);</span><br><span class="line">	System.out.println(result.getContent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="集成Ehcache"><a href="#集成Ehcache" class="headerlink" title="集成Ehcache"></a>集成Ehcache</h1><p>添加pom依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;net.sf.ehcache&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;ehcache&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#spring.cache.type=ehcache		spring.cache.type=redis		</span><br><span class="line">spring.cache.ehcache.config=classpath:config/ehcache.xml #默认路径在resources下</span><br><span class="line">创建ehcache.xml缓存策略</span><br><span class="line">&lt;ehcache xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xsi:noNamespaceSchemaLocation=&quot;ehcache.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;cache name=&quot;roncooCache&quot; </span><br><span class="line">		eternal=&quot;false&quot; </span><br><span class="line">		maxEntriesLocalHeap=&quot;0&quot;</span><br><span class="line">		timeToIdleSeconds=&quot;200&quot;&gt;&lt;/cache&gt;</span><br><span class="line"></span><br><span class="line">	&lt;!-- eternal：true表示对象永不过期，此时会忽略timeToIdleSeconds和timeToLiveSeconds属性，默认为false --&gt;</span><br><span class="line">	&lt;!-- maxEntriesLocalHeap：堆内存中最大缓存对象数，0没有限制 --&gt;</span><br><span class="line">	&lt;!-- timeToIdleSeconds： 设定允许对象处于空闲状态的最长时间，以秒为单位。当对象自从最近一次被访问后，如果处于空闲状态的时间超过了timeToIdleSeconds属性值，这个对象就会过期，EHCache将把它从缓存中清空。只有当eternal属性为false，该属性才有效。如果该属性值为0，则表示对象可以无限期地处于空闲状态 --&gt;</span><br><span class="line">&lt;/ehcache&gt;</span><br></pre></td></tr></table></figure></p>
<p>@CacheConfig：缓存配置<br>@Cacheable：应用到读取数据的方法上，即可缓存的方法，如查找方法：先从缓存中读取，如果没有再调用方法获取数据，然后把数据添加到缓存中。适用于查找<br>@CachePut：主要针对方法配置，能够根据方法的请求参数对其结果进行缓存，和 @Cacheable 不同的是，它每次都会触发真实方法的调用。适用于更新和插入<br>@CacheEvict：主要针对方法配置，能够根据一定的条件对缓存进行清空。适用于删除<br>创建接口和实现类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public interface RoncooUserLogCache &#123;</span><br><span class="line">	RoncooUserLog selectById(Integer id);</span><br><span class="line">	RoncooUserLog updateById(RoncooUserLog roncooUserLog);</span><br><span class="line">	String deleteById(Integer id);</span><br><span class="line">&#125;</span><br><span class="line">@CacheConfig(cacheNames = &quot;roncooCache&quot;)</span><br><span class="line">@Repository</span><br><span class="line">public class RoncooUserLogCacheImpl implements RoncooUserLogCache &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserLogDao roncooUserLogDao;</span><br><span class="line">	@Cacheable(key = &quot;#p0&quot;)</span><br><span class="line">	@Override</span><br><span class="line">	public RoncooUserLog selectById(Integer id) &#123;</span><br><span class="line">		System.out.println(&quot;查询功能，缓存找不到，直接读库, id=&quot; + id);</span><br><span class="line">		return roncooUserLogDao.findOne(id);</span><br><span class="line">	&#125;</span><br><span class="line">	@CachePut(key = &quot;#p0&quot;)</span><br><span class="line">	@Override</span><br><span class="line">	public RoncooUserLog updateById(RoncooUserLog roncooUserLog) &#123;</span><br><span class="line">		System.out.println(&quot;更新功能，更新缓存，直接写库, id=&quot; + roncooUserLog);</span><br><span class="line">		return roncooUserLogDao.save(roncooUserLog);</span><br><span class="line">	&#125;</span><br><span class="line">	@CacheEvict(key = &quot;#p0&quot;)</span><br><span class="line">	@Override</span><br><span class="line">	public String deleteById(Integer id) &#123;</span><br><span class="line">		System.out.println(&quot;删除功能，删除缓存，直接写库, id=&quot; + id);</span><br><span class="line">		return &quot;清空缓存成功&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>搭建Controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/api&quot;)</span><br><span class="line">public class ApiController &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserLogCache roncooUserLogCache;</span><br><span class="line">	@RequestMapping(value = &quot;/select&quot;, method = RequestMethod.GET)</span><br><span class="line">	public RoncooUserLog get(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">		return roncooUserLogCache.selectById(id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(value = &quot;/update&quot;, method = RequestMethod.GET)</span><br><span class="line">	public RoncooUserLog update(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">		RoncooUserLog bean = roncooUserLogCache.selectById(id);</span><br><span class="line">		bean.setUserName(&quot;测试&quot;);</span><br><span class="line">		bean.setCreateTime(new Date());</span><br><span class="line">		roncooUserLogCache.updateById(bean);</span><br><span class="line">		return bean;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(value = &quot;/del&quot;, method = RequestMethod.GET)</span><br><span class="line">	public String del(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">		return roncooUserLogCache.deleteById(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>主程序编写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@EnableCaching</span><br><span class="line">@ServletComponentScan</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo201Application &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo201Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="springboot-redis-cache集成"><a href="#springboot-redis-cache集成" class="headerlink" title="springboot_redis cache集成"></a>springboot_redis cache集成</h1><p>ehcache主要用于本地缓存<br>redis主要用于集群<br>添加依赖pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cache.type=redis</span><br></pre></td></tr></table></figure></p>
<p>配置策略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RedisCacheConfiguration extends CachingConfigurerSupport &#123;</span><br><span class="line"></span><br><span class="line">	@Bean</span><br><span class="line">	public CacheManager cacheManager(RedisTemplate&lt;?, ?&gt; redisTemplate) &#123;</span><br><span class="line">		RedisCacheManager cacheManager = new RedisCacheManager(redisTemplate);</span><br><span class="line">		// 设置默认的过期时间</span><br><span class="line">		cacheManager.setDefaultExpiration(20);</span><br><span class="line">		Map&lt;String, Long&gt; expires = new HashMap&lt;String, Long&gt;();</span><br><span class="line">		// 单独设置</span><br><span class="line">		expires.put(&quot;roncooCache&quot;, 200L);</span><br><span class="line">		cacheManager.setExpires(expires);</span><br><span class="line">		return cacheManager;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public KeyGenerator keyGenerator() &#123;</span><br><span class="line">		return new KeyGenerator() &#123;</span><br><span class="line">			@Override</span><br><span class="line">			public Object generate(Object o, Method method, Object... objects) &#123;</span><br><span class="line">				StringBuilder sb = new StringBuilder();</span><br><span class="line">				sb.append(o.getClass().getName());</span><br><span class="line">				sb.append(method.getName());</span><br><span class="line">				for (Object obj : objects) &#123;</span><br><span class="line">					sb.append(obj.toString());</span><br><span class="line">				&#125;</span><br><span class="line">				return sb.toString();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>序列化实体类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">public class RoncooUserLog implements Serializable&#123;</span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line">	@Id</span><br><span class="line">	@GeneratedValue</span><br><span class="line">	private Integer id;</span><br><span class="line">	@Column</span><br><span class="line">	private Date createTime;</span><br><span class="line">	@Column</span><br><span class="line">	private String userName;</span><br><span class="line">	@Column</span><br><span class="line">	private String userIp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接口开发<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/select&quot;, method = RequestMethod.GET)</span><br><span class="line">public RoncooUserLog get(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">	return roncooUserLogCache.selectById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/update&quot;, method = RequestMethod.GET)</span><br><span class="line">public RoncooUserLog update(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">	RoncooUserLog bean = roncooUserLogCache.selectById(id);</span><br><span class="line">	bean.setUserName(&quot;测试&quot;);</span><br><span class="line">	bean.setCreateTime(new Date());</span><br><span class="line">	roncooUserLogCache.updateById(bean);</span><br><span class="line">	return bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value = &quot;/del&quot;, method = RequestMethod.GET)</span><br><span class="line">public String del(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">	return roncooUserLogCache.deleteById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="异步消息JMS-ActiveMQ"><a href="#异步消息JMS-ActiveMQ" class="headerlink" title="异步消息JMS_ActiveMQ"></a>异步消息JMS_ActiveMQ</h1><p>添加pom依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-activemq&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.activemq.in-memory=true</span><br></pre></td></tr></table></figure></p>
<p>队列配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class JmsConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public Queue queue() &#123;//定义队列</span><br><span class="line">		return new ActiveMQQueue(&quot;roncoo.queue&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建生产者消费者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class RoncooJmsComponent &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private JmsMessagingTemplate jmsMessagingTemplate;</span><br><span class="line">	@Autowired</span><br><span class="line">	private Queue queue;</span><br><span class="line"></span><br><span class="line">	public void send(String msg) &#123;//消息发送到队列</span><br><span class="line">		this.jmsMessagingTemplate.convertAndSend(this.queue, msg);</span><br><span class="line">	&#125;</span><br><span class="line">	@JmsListener(destination = &quot;roncoo.queue&quot;)</span><br><span class="line">	public void receiveQueue(String text) &#123;</span><br><span class="line">		System.out.println(&quot;接受到：&quot; + text);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>开启主函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@EnableJms </span><br><span class="line">@EnableCaching</span><br><span class="line">@ServletComponentScan</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo211Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo211Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo211ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooJmsComponent roncooJmsComponent;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void send() &#123;</span><br><span class="line">		roncooJmsComponent.send(&quot;hello world&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="异步消息AMQP——RabbitMQ"><a href="#异步消息AMQP——RabbitMQ" class="headerlink" title="异步消息AMQP——RabbitMQ"></a>异步消息AMQP——RabbitMQ</h1><p>安装并开启RabbitMQ<br>添加pom配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>参数配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># RABBIT (RabbitProperties)</span><br><span class="line">#spring.rabbitmq.host=localhost</span><br><span class="line">#spring.rabbitmq.port=5672</span><br><span class="line">#spring.rabbitmq.password=</span><br><span class="line">#spring.rabbitmq.username=</span><br></pre></td></tr></table></figure></p>
<p>队列配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class AmqpConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public Queue queue() &#123;</span><br><span class="line">		return new Queue(&quot;roncoo.queue&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建生产者消费者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class RoncooAmqpComponent &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private AmqpTemplate amqpTemplate;</span><br><span class="line">	public void send(String msg) &#123;</span><br><span class="line">		this.amqpTemplate.convertAndSend(&quot;roncoo.queue&quot;, msg);</span><br><span class="line">	&#125;</span><br><span class="line">	@RabbitListener(queues = &quot;roncoo.queue&quot;)</span><br><span class="line">	public void receiveQueue(String text) &#123;</span><br><span class="line">		System.out.println(&quot;接受到：&quot; + text);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>开启主程序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@EnableRabbit</span><br><span class="line">@EnableCaching</span><br><span class="line">@ServletComponentScan</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo221Application &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo221Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo221ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooAmqpComponent roncooAmqpComponent;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void send() &#123;</span><br><span class="line">		roncooAmqpComponent.send(&quot;hello world2&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="调用远程rest服务及使用代理"><a href="#调用远程rest服务及使用代理" class="headerlink" title="调用远程rest服务及使用代理"></a>调用远程rest服务及使用代理</h1><h2 id="项目一"><a href="#项目一" class="headerlink" title="项目一"></a>项目一</h2><p>添加pom依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>创建rest接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/rest&quot;, method = RequestMethod.POST)</span><br><span class="line">public class RestRoncooController &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserLogCache RoncooUserLogCache;</span><br><span class="line">	@RequestMapping(value = &quot;/update&quot;)//http://localhost:8080/rest/update/1</span><br><span class="line">	public RoncooUserLog update(@RequestBody JsonNode jsonNode) &#123;//接收rest参数json</span><br><span class="line">		System.out.println(&quot;jsonNode=&quot; + jsonNode);</span><br><span class="line">		RoncooUserLog bean = RoncooUserLogCache.selectById(jsonNode.get(&quot;id&quot;).asInt(1));</span><br><span class="line">		if(bean == null)&#123;</span><br><span class="line">			bean = new RoncooUserLog();</span><br><span class="line">		&#125;</span><br><span class="line">		bean.setUserName(&quot;测试&quot;);</span><br><span class="line">		bean.setCreateTime(new Date());</span><br><span class="line">		bean.setUserIp(&quot;192.168.1.1&quot;);</span><br><span class="line">		RoncooUserLogCache.updateById(bean);</span><br><span class="line">		return bean;</span><br><span class="line">	&#125;</span><br><span class="line">	@RequestMapping(value = &quot;/update/&#123;id&#125;&quot;, method = RequestMethod.GET)</span><br><span class="line">	public RoncooUserLog update2(@PathVariable(value = &quot;id&quot;) Integer id) &#123;</span><br><span class="line">		RoncooUserLog bean = RoncooUserLogCache.selectById(id);</span><br><span class="line">		if(bean == null)&#123;</span><br><span class="line">			bean = new RoncooUserLog();</span><br><span class="line">		&#125;</span><br><span class="line">		bean.setUserName(&quot;测试&quot;);</span><br><span class="line">		bean.setCreateTime(new Date());</span><br><span class="line">		bean.setUserIp(&quot;192.168.1.1&quot;);</span><br><span class="line">		RoncooUserLogCache.updateById(bean);</span><br><span class="line">		return bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>启动主程序配置在8080端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@EnableCaching</span><br><span class="line">@ServletComponentScan</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpringBootDemo231Application &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo231Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="项目二"><a href="#项目二" class="headerlink" title="项目二"></a>项目二</h2><p>添加pom依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>修改配置环境<br>spring.profiles.active=test使得启动时以8081端口启动<br>远程调用rest接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo231ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RestTemplateBuilder restTemplateBuilder;</span><br><span class="line">	@Test</span><br><span class="line">	public void getForObject() &#123;</span><br><span class="line">		RoncooUserLog bean = restTemplateBuilder.build().getForObject(&quot;http://localhost:8080/rest/update/&#123;id&#125;&quot;,</span><br><span class="line">				RoncooUserLog.class, 1);</span><br><span class="line">		System.out.println(bean);</span><br><span class="line">		Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		map.put(&quot;id&quot;, 2);</span><br><span class="line">		bean = restTemplateBuilder.build().postForObject(&quot;http://localhost:8080/rest/update&quot;, map, RoncooUserLog.class);</span><br><span class="line">		System.out.println(bean);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代理服务调用rest接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo231ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RestTemplateBuilder restTemplateBuilder;</span><br><span class="line">	@Test</span><br><span class="line">	public void getForObject1() &#123;</span><br><span class="line">		RoncooUserLog bean = restTemplateBuilder.build().getForObject(&quot;http://localhost:8080/rest/update/&#123;id&#125;&quot;,</span><br><span class="line">				RoncooUserLog.class, 1);</span><br><span class="line">		System.out.println(bean);</span><br><span class="line">		Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		map.put(&quot;id&quot;, 2);</span><br><span class="line">		bean = restTemplateBuilder.build().postForObject(&quot;http://localhost:8080/rest/update&quot;, map, RoncooUserLog.class);</span><br><span class="line">		System.out.println(bean);</span><br><span class="line"></span><br><span class="line">		String result = restTemplateBuilder.additionalCustomizers(new ProxyCustomizer()).build()</span><br><span class="line">				.getForObject(&quot;http://www.roncoo.com&quot;, String.class);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	static class ProxyCustomizer implements RestTemplateCustomizer &#123;</span><br><span class="line">		@Override</span><br><span class="line">		public void customize(RestTemplate restTemplate) &#123;</span><br><span class="line">			String proxyHost = &quot;43.255.104.179&quot;;</span><br><span class="line">			int proxyPort = 8080;</span><br><span class="line"></span><br><span class="line">			HttpHost proxy = new HttpHost(proxyHost, proxyPort);</span><br><span class="line">			HttpClient httpClient = HttpClientBuilder.create().setRoutePlanner(new DefaultProxyRoutePlanner(proxy) &#123;</span><br><span class="line">				@Override</span><br><span class="line">				public HttpHost determineProxy(HttpHost target, HttpRequest request, HttpContext context)</span><br><span class="line">						throws HttpException &#123;</span><br><span class="line">					System.out.println(target.getHostName());</span><br><span class="line">					return super.determineProxy(target, request, context);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;).build();</span><br><span class="line">			HttpComponentsClientHttpRequestFactory httpComponentsClientHttpRequestFactory = new HttpComponentsClientHttpRequestFactory(</span><br><span class="line">					httpClient);</span><br><span class="line">			httpComponentsClientHttpRequestFactory.setConnectTimeout(10000);</span><br><span class="line">			httpComponentsClientHttpRequestFactory.setReadTimeout(60000);</span><br><span class="line">			restTemplate.setRequestFactory(httpComponentsClientHttpRequestFactory);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="多账号发送邮件"><a href="#多账号发送邮件" class="headerlink" title="多账号发送邮件"></a>多账号发送邮件</h1><p>添加pom依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># mail</span><br><span class="line">spring.mail.host: smtp.exmail.qq.com</span><br><span class="line">spring.mail.username:xxx@qq.com,xxx@163.com</span><br><span class="line">spring.mail.password:xxx,xxx</span><br><span class="line">spring.mail.properties.mail.smtp.auth: true</span><br><span class="line">spring.mail.properties.mail.debug: true</span><br><span class="line">spring.mail.properties.smtp.starttls.required=true</span><br><span class="line">spring.mail.properties.mail.smtp.ssl.enable=true</span><br><span class="line">spring.mail.properties.smtp.starttls.enable=true</span><br></pre></td></tr></table></figure></p>
<p>多账号轮询发送接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableConfigurationProperties(MailProperties.class)</span><br><span class="line">public class RoncooJavaMailSenderImpl extends JavaMailSenderImpl implements JavaMailSender &#123;</span><br><span class="line">	private ArrayList&lt;String&gt; usernameList;</span><br><span class="line">	private ArrayList&lt;String&gt; passwordList;</span><br><span class="line">	private int currentMailId = 0;</span><br><span class="line">	private final MailProperties properties;</span><br><span class="line">	public RoncooJavaMailSenderImpl(MailProperties properties) &#123;</span><br><span class="line">		this.properties = properties;</span><br><span class="line">		// 初始化账号</span><br><span class="line">		if (usernameList == null)</span><br><span class="line">			usernameList = new ArrayList&lt;String&gt;();</span><br><span class="line">		String[] userNames = this.properties.getUsername().split(&quot;,&quot;);</span><br><span class="line">		if (userNames != null) &#123;</span><br><span class="line">			for (String user : userNames) &#123;</span><br><span class="line">				usernameList.add(user);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		// 初始化密码</span><br><span class="line">		if (passwordList == null)</span><br><span class="line">			passwordList = new ArrayList&lt;String&gt;();</span><br><span class="line">		String[] passwords = this.properties.getPassword().split(&quot;,&quot;);</span><br><span class="line">		if (passwords != null) &#123;</span><br><span class="line">			for (String pw : passwords) &#123;</span><br><span class="line">				passwordList.add(pw);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	protected void doSend(MimeMessage[] mimeMessage, Object[] object) throws MailException &#123;</span><br><span class="line"></span><br><span class="line">		super.setUsername(usernameList.get(currentMailId));</span><br><span class="line">		super.setPassword(passwordList.get(currentMailId));</span><br><span class="line"></span><br><span class="line">		// 设置编码和各种参数</span><br><span class="line">		super.setHost(this.properties.getHost());</span><br><span class="line">		super.setDefaultEncoding(this.properties.getDefaultEncoding().name());</span><br><span class="line">		super.setJavaMailProperties(asProperties(this.properties.getProperties()));</span><br><span class="line">		super.doSend(mimeMessage, object);</span><br><span class="line"></span><br><span class="line">		// 轮询</span><br><span class="line">		currentMailId = (currentMailId + 1) % usernameList.size();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private Properties asProperties(Map&lt;String, String&gt; source) &#123;</span><br><span class="line">		Properties properties = new Properties();</span><br><span class="line">		properties.putAll(source);</span><br><span class="line">		return properties;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getUsername() &#123;</span><br><span class="line">		return usernameList.get(currentMailId);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建组件类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class RoncooJavaMailComponent &#123;</span><br><span class="line">	private static final String template = &quot;mail/roncoo.ftl&quot;;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private FreeMarkerConfigurer freeMarkerConfigurer;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooJavaMailSenderImpl javaMailSender;</span><br><span class="line"></span><br><span class="line">	public void sendMail(String email) &#123;</span><br><span class="line">		Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">		map.put(&quot;email&quot;, email);</span><br><span class="line">		try &#123;</span><br><span class="line">			String text = getTextByTemplate(template, map);</span><br><span class="line">			send(email, text);</span><br><span class="line">		&#125; catch (IOException | TemplateException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; catch (MessagingException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	private String getTextByTemplate(String template, Map&lt;String, Object&gt; model) throws TemplateNotFoundException, MalformedTemplateNameException, ParseException, IOException, TemplateException &#123;</span><br><span class="line">		return FreeMarkerTemplateUtils.processTemplateIntoString(freeMarkerConfigurer.getConfiguration().getTemplate(template), model);</span><br><span class="line">	&#125;</span><br><span class="line">	private String send(String email, String text) throws MessagingException, UnsupportedEncodingException &#123;</span><br><span class="line">		MimeMessage message = javaMailSender.createMimeMessage();</span><br><span class="line">		MimeMessageHelper helper = new MimeMessageHelper(message, true, &quot;UTF-8&quot;);</span><br><span class="line">		InternetAddress from = new InternetAddress();</span><br><span class="line">		from.setAddress(javaMailSender.getUsername());</span><br><span class="line">		from.setPersonal(&quot;龙果学院&quot;, &quot;UTF-8&quot;);</span><br><span class="line">		helper.setFrom(from);</span><br><span class="line">		helper.setTo(email);</span><br><span class="line">		helper.setSubject(&quot;测试邮件&quot;);</span><br><span class="line">		helper.setText(text, true);</span><br><span class="line">		javaMailSender.send(message);</span><br><span class="line">		return text;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>发送入口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">多次发送则轮训发送</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;email&quot; id=&quot;email&quot; /&gt;</span><br><span class="line">&lt;button id=&quot;send&quot;&gt;发送邮件&lt;/button&gt;</span><br><span class="line">$(function()&#123;</span><br><span class="line">	$(&apos;#send&apos;).click(function()&#123;</span><br><span class="line">		var email = $(&apos;#email&apos;).val();</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">			url:&apos;/api/mail&apos;,</span><br><span class="line">			type:&apos;post&apos;,</span><br><span class="line">			data:&#123;&apos;email&apos;:email&#125;,</span><br><span class="line">			success:function(msg)&#123;</span><br><span class="line">				alert(msg);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>邮件html模板<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;width: 600px; text-align: left; margin: 0 auto;&quot;&gt;</span><br><span class="line">	&lt;h1 style=&quot;color: #005da7;&quot;&gt;龙果学院&lt;/h1&gt;</span><br><span class="line">	&lt;div style=&quot;border-bottom: 5px solid #005da7; height: 2px; width: 100%;&quot;&gt;&lt;/div&gt;</span><br><span class="line">	&lt;div style=&quot;border: 1px solid #005da7; font-size: 16px; line-height: 50px; padding: 20px;&quot;&gt;</span><br><span class="line">		&lt;div&gt;$&#123;email&#125;，您好！&lt;/div&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			这是个测试</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;div style=&quot;border-bottom: 2px solid #005da7; height: 2px; width: 100%;&quot;&gt;&lt;/div&gt;</span><br><span class="line">		&lt;div&gt;扫一扫，关注龙果学院微信公共号，里面更多精彩推荐&lt;/div&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			&lt;img src=&quot;http://account.roncoo.com/images/qrcode.png&quot; alt=&quot;龙果学院公众号二维码&quot; /&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div&gt;</span><br><span class="line">			想了解更多信息，请访问 &lt;a href=&quot;http://www.roncoo.com&quot;&gt;http://www.roncoo.com&lt;/a&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="spring-session-cluster"><a href="#spring-session-cluster" class="headerlink" title="spring_session_cluster"></a>spring_session_cluster</h1><p>1.扩展指定server<br>利用Servlet容器提供的插件功能，自定义HttpSession的创建和管理策略，并通过配置的方式替换掉默认的策略。缺点：耦合Tomcat/Jetty等Servlet容器，不能随意更换容器。<br>2.利用Filter<br>利用HttpServletRequestWrapper，实现自己的 getSession()方法，接管创建和管理Session数据的工作。spring-session就是通过这样的思路实现的。<br>3.Spring Boot中spring session支持方式：<br>JDBC、MongoDB、Redis、Hazelcast、HashMap</p>
<h2 id="项目一-1"><a href="#项目一-1" class="headerlink" title="项目一"></a>项目一</h2><p>添加依赖pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring session --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-session&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- redis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># spring session使用存储类型</span><br><span class="line">spring.session.store-type=redis</span><br><span class="line"># spring session刷新模式：默认on-save</span><br><span class="line">#spring.session.redis.flush-mode=on-save</span><br><span class="line">#spring.session.redis.namespace=</span><br><span class="line"># session超时时间，单位秒</span><br><span class="line">#server.session.timeout=30</span><br><span class="line"></span><br><span class="line">#redis</span><br><span class="line">spring.redis.host=localhost</span><br><span class="line">spring.redis.port=6379</span><br><span class="line">spring.redis.password=123456</span><br><span class="line">#spring.redis.database=0</span><br><span class="line">#spring.redis.pool.max-active=8</span><br><span class="line">#spring.redis.pool.max-idle=8</span><br><span class="line">#spring.redis.pool.max-wait=-1</span><br><span class="line">#spring.redis.pool.min-idle=0</span><br><span class="line">#spring.redis.timeout=0</span><br></pre></td></tr></table></figure></p>
<p>控制器编写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/web&quot;)</span><br><span class="line">public class WebController &#123;</span><br><span class="line">	</span><br><span class="line">	private static final Logger logger =  LoggerFactory.getLogger(WebController.class);</span><br><span class="line">	</span><br><span class="line">	@RequestMapping(value = &quot;/index&quot;)//http://localhost:8080/web/index</span><br><span class="line">	public String index(ModelMap map, HttpSession httpSession) &#123;</span><br><span class="line">		map.put(&quot;title&quot;, &quot;第一个应用：sessionID=&quot; + httpSession.getId());</span><br><span class="line">		logger.info(&quot;sessionID=&quot; + httpSession.getId());</span><br><span class="line">		return &quot;index&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="项目二-1"><a href="#项目二-1" class="headerlink" title="项目二"></a>项目二</h2><p>修改端口8081启动<a href="http://localhost:8081/web/index发现获取的sessionid一致" target="_blank" rel="noopener">http://localhost:8081/web/index发现获取的sessionid一致</a></p>
<h1 id="远程调试"><a href="#远程调试" class="headerlink" title="远程调试"></a>远程调试</h1><p>mvn clean package -Dmaven.test.skip=true    编译测试但运行时跳过<br>mvn clean package -DskipTests               跳过编译同时不运行<br>java -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8000,suspend=n –jar  spring-boot-demo-24-1-0.0.1-SNAPSHOT.jar远程主机启动<br>本地开启Remote java Application配置8000端口参数和IP参数进行远程Debug，必须保证远程本地代码一致</p>
<h1 id="基于HTTP的监控"><a href="#基于HTTP的监控" class="headerlink" title="基于HTTP的监控"></a>基于HTTP的监控</h1><p>端点（通过执行器端点可以监控应用及与应用进行交互）</p>
<ol>
<li>端点暴露的方式取决于你采用的监控方式。如果使用HTTP监控，端点的ID映射到一个URL。例如，默认情况下，health端点将被映射到/health。</li>
<li>端点会默认有敏感度，根据不同的敏感度是否需要提供用户密码认证</li>
<li>如果没启用web安全，则敏感度高的会禁用</li>
<li>可以通过配置文件进行配置敏感度</li>
<li>默认情况下，除了shutdown外的所有端点都是启用的。</li>
</ol>
<p>添加pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>localhost:8080/mappings<br>localhost:8080/metrics<br>配置敏感度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#端点的配置</span><br><span class="line">endpoints.sensitive=true</span><br><span class="line">endpoints.shutdown.enabled=true</span><br></pre></td></tr></table></figure></p>
<p>localhost:8080/shutdown  post请求关闭应用<br>定义权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#保护端点</span><br><span class="line">security.basic.enabled=true</span><br><span class="line">security.user.name=roncoo1</span><br><span class="line">security.user.password=roncoo1</span><br><span class="line">management.security.roles=SUPERUSER</span><br><span class="line">需要加入依赖包</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>自定义路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security.basic.path=/manage</span><br><span class="line">management.context-path=/manage</span><br></pre></td></tr></table></figure></p>
<p>localhost:8080/manage/metrics才被拦截<br>localhost:8080/manage/trace才被拦截</p>
<h1 id="springboot-mybatis"><a href="#springboot-mybatis" class="headerlink" title="springboot_mybatis"></a>springboot_mybatis</h1><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p>添加pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:mysql://localhost/test?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure></p>
<p>Mapper编写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface RoncooUserMapper &#123;</span><br><span class="line"></span><br><span class="line">	@Insert(value = &quot;insert into roncoo_user (name, create_time) values (#&#123;name,jdbcType=VARCHAR&#125;, #&#123;createTime,jdbcType=TIMESTAMP&#125;)&quot;)</span><br><span class="line">	int insert(RoncooUser record);</span><br><span class="line"></span><br><span class="line">	@Select(value = &quot;select id, name, create_time from roncoo_user where id = #&#123;id,jdbcType=INTEGER&#125;&quot;)</span><br><span class="line">	@Results(value = &#123; @Result(column = &quot;create_time&quot;, property = &quot;createTime&quot;, jdbcType = JdbcType.TIMESTAMP) &#125;)</span><br><span class="line">	RoncooUser selectByPrimaryKey(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo281ApplicationTests &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserMapper mapper;</span><br><span class="line">	@Test</span><br><span class="line">	public void insert() &#123;</span><br><span class="line">		RoncooUser roncooUser = new RoncooUser();</span><br><span class="line">		roncooUser.setName(&quot;测试&quot;);</span><br><span class="line">		roncooUser.setCreateTime(new Date());</span><br><span class="line">		int result = mapper.insert(roncooUser);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="xml配置"><a href="#xml配置" class="headerlink" title="xml配置"></a>xml配置</h2><p>配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># mysql</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost/test?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br><span class="line"></span><br><span class="line">#mybatis</span><br><span class="line">mybatis.mapper-locations: classpath:mybatis/*.xml</span><br></pre></td></tr></table></figure></p>
<p>xml配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectByPrimaryKey&quot; resultMap=&quot;BaseResultMap&quot; parameterType=&quot;java.lang.Integer&quot; &gt;</span><br><span class="line">  select </span><br><span class="line">  &lt;include refid=&quot;Base_Column_List&quot; /&gt;</span><br><span class="line">  from roncoo_user</span><br><span class="line">  where id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;insert id=&quot;insert&quot; parameterType=&quot;com.roncoo.education.bean.RoncooUser&quot; &gt;</span><br><span class="line">  insert into roncoo_user (id, name, create_time</span><br><span class="line">    )</span><br><span class="line">  values (#&#123;id,jdbcType=INTEGER&#125;, #&#123;name,jdbcType=VARCHAR&#125;, #&#123;createTime,jdbcType=TIMESTAMP&#125;</span><br><span class="line">    )</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure></p>
<p>Mapper编写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface RoncooUserMapper &#123;</span><br><span class="line">    int insert(RoncooUser record);</span><br><span class="line">    RoncooUser selectByPrimaryKey(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试类编写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringBootDemo282ApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserMapper mapper;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void insert() &#123;</span><br><span class="line">		RoncooUser roncooUser = new RoncooUser();</span><br><span class="line">		roncooUser.setName(&quot;测试&quot;);</span><br><span class="line">		roncooUser.setCreateTime(new Date());</span><br><span class="line">		int result = mapper.insert(roncooUser);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Test</span><br><span class="line">	public void select() &#123;</span><br><span class="line">		RoncooUser result = mapper.selectByPrimaryKey(2);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="集成Druid"><a href="#集成Druid" class="headerlink" title="集成Druid"></a>集成Druid</h1><p>添加pom依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.26&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># mysql</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost/test?useUnicode=true&amp;characterEncoding=utf-8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span><br><span class="line">spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">#spring.datasource.type=org.apache.tomcat.jdbc.pool.DataSource</span><br><span class="line">#初始化连接大小</span><br><span class="line">spring.datasource.druid.initial-size=8</span><br><span class="line">#最小空闲连接数</span><br><span class="line">spring.datasource.druid.min-idle=5</span><br><span class="line">#最大连接数</span><br><span class="line">spring.datasource.druid.max-active=10</span><br><span class="line">#查询超时时间</span><br><span class="line">spring.datasource.druid.query-timeout=6000</span><br><span class="line">#事务查询超时时间</span><br><span class="line">spring.datasource.druid.transaction-query-timeout=6000</span><br><span class="line">#关闭空闲连接超时时间</span><br><span class="line">spring.datasource.druid.remove-abandoned-timeout=1800</span><br><span class="line">spring.datasource.druid.filter-class-names=stat</span><br><span class="line">#sql监控</span><br><span class="line">spring.datasource.druid.filters=stat,config</span><br></pre></td></tr></table></figure></p>
<p>druid-bean配置spring<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置_Druid和Spring关联监控配置 --&gt;</span><br><span class="line">&lt;bean id=&quot;druid-stat-interceptor&quot;</span><br><span class="line">	class=&quot;com.alibaba.druid.support.spring.stat.DruidStatInterceptor&quot;&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 方法名正则匹配拦截配置 --&gt;</span><br><span class="line">&lt;bean id=&quot;druid-stat-pointcut&quot; class=&quot;org.springframework.aop.support.JdkRegexpMethodPointcut&quot;</span><br><span class="line">	scope=&quot;prototype&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;patterns&quot;&gt;</span><br><span class="line">		&lt;list&gt;</span><br><span class="line">			&lt;value&gt;com.roncoo.education.mapper.*&lt;/value&gt;</span><br><span class="line">		&lt;/list&gt;</span><br><span class="line">	&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;aop:config proxy-target-class=&quot;true&quot;&gt;</span><br><span class="line">	&lt;aop:advisor advice-ref=&quot;druid-stat-interceptor&quot;</span><br><span class="line">		pointcut-ref=&quot;druid-stat-pointcut&quot; /&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure></p>
<p>获取配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class DruidConfiguration &#123;</span><br><span class="line">	@ConditionalOnClass(DruidDataSource.class)</span><br><span class="line">	@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;, havingValue = &quot;com.alibaba.druid.pool.DruidDataSource&quot;, matchIfMissing = true)</span><br><span class="line">	static class Druid extends DruidConfiguration &#123;</span><br><span class="line">		@Bean</span><br><span class="line">		@ConfigurationProperties(&quot;spring.datasource.druid&quot;)</span><br><span class="line">		public DruidDataSource dataSource(DataSourceProperties properties) &#123;</span><br><span class="line">			DruidDataSource druidDataSource = (DruidDataSource) properties.initializeDataSourceBuilder().type(DruidDataSource.class).build();</span><br><span class="line">			DatabaseDriver databaseDriver = DatabaseDriver.fromJdbcUrl(properties.determineUrl());</span><br><span class="line">			String validationQuery = databaseDriver.getValidationQuery();</span><br><span class="line">			if (validationQuery != null) &#123;</span><br><span class="line">				druidDataSource.setValidationQuery(validationQuery);</span><br><span class="line">			&#125;</span><br><span class="line">			return druidDataSource;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建权限Servelet<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(urlPatterns = &#123; &quot;/druid/*&quot; &#125;, initParams = &#123; @WebInitParam(name = &quot;loginUsername&quot;, value = &quot;roncoo&quot;), @WebInitParam(name = &quot;loginPassword&quot;, value = &quot;roncoo&quot;) &#125;)</span><br><span class="line">public class DruidStatViewServlet extends StatViewServlet &#123;</span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建资源filter<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@WebFilter(filterName = &quot;druidWebStatFilter&quot;, urlPatterns = &quot;/*&quot;, initParams = &#123; @WebInitParam(name = &quot;exclusions&quot;, value = &quot;*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*&quot;) &#125;)</span><br><span class="line">public class DruidWebStatFilter extends WebStatFilter &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建控制器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/api&quot;)</span><br><span class="line">public class ApiController &#123;</span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserMapper roncooUserMappper;</span><br><span class="line"></span><br><span class="line">	@RequestMapping(value = &quot;/select&quot;, method = RequestMethod.GET)</span><br><span class="line">	public RoncooUser get(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">		return roncooUserMappper.selectByPrimaryKey(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>主程序启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@ServletComponentScan</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@ImportResource(locations = &#123; &quot;classpath:druid-bean.xml&quot; &#125;)</span><br><span class="line">public class SpringBootDemo291Application &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(SpringBootDemo291Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://localhost:8080/druid/index.html" target="_blank" rel="noopener">http://localhost:8080/druid/index.html</a><br><a href="http://localhost:8080/api/select" target="_blank" rel="noopener">http://localhost:8080/api/select</a>    使用时才实例化在控制面板可以看到数据源等监控</p>
<h1 id="集成swagger"><a href="#集成swagger" class="headerlink" title="集成swagger"></a>集成swagger</h1><p>添加pom<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.6.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.6.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加配置类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableSwagger2</span><br><span class="line">public class Swagger2Configuration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public Docket accessToken() &#123;</span><br><span class="line">		return new Docket(DocumentationType.SWAGGER_2).groupName(&quot;api&quot;)// 定义组</span><br><span class="line">				.select() // 选择那些路径和api会生成document</span><br><span class="line">				.apis(RequestHandlerSelectors.basePackage(&quot;com.roncoo.education.controller&quot;)) // 拦截的包路径</span><br><span class="line">				.paths(regex(&quot;/api/.*&quot;))// 拦截的接口路径</span><br><span class="line">				.build() // 创建</span><br><span class="line">				.apiInfo(apiInfo()); // 配置说明</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private ApiInfo apiInfo() &#123;</span><br><span class="line">		return new ApiInfoBuilder()//</span><br><span class="line">				.title(&quot;龙果学院&quot;)// 标题</span><br><span class="line">				.description(&quot;spring boot 全集&quot;)// 描述</span><br><span class="line">				.termsOfServiceUrl(&quot;http://www.roncoo.com&quot;)//</span><br><span class="line">				.contact(new Contact(&quot;wujing&quot;, &quot;http://www.roncoo.com&quot;, &quot;297115770@qq.com&quot;))// 联系</span><br><span class="line">				//.license(&quot;Apache License Version 2.0&quot;)// 开源协议</span><br><span class="line">				//.licenseUrl(&quot;https://github.com/springfox/springfox/blob/master/LICENSE&quot;)// 地址</span><br><span class="line">				.version(&quot;1.0&quot;)// 版本</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建Controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/api&quot;)</span><br><span class="line">public class ApiController &#123;</span><br><span class="line"></span><br><span class="line">	@Autowired</span><br><span class="line">	private RoncooUserMapper roncooUserMappper;</span><br><span class="line"></span><br><span class="line">	@ApiOperation(value = &quot;查找&quot;, notes = &quot;根据用户ID查找用户&quot;)</span><br><span class="line">	@RequestMapping(value = &quot;/select&quot;, method = RequestMethod.GET)</span><br><span class="line">	public RoncooUser get(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">		return roncooUserMappper.selectByPrimaryKey(id);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@ApiIgnore</span><br><span class="line">	@RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.GET)</span><br><span class="line">	public int delete(@RequestParam(defaultValue = &quot;1&quot;) Integer id) &#123;</span><br><span class="line">		return roncooUserMappper.deleteByPrimaryKey(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="生产环境脚本"><a href="#生产环境脚本" class="headerlink" title="生产环境脚本"></a>生产环境脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">## chang here</span><br><span class="line">SERVICE_DIR=/roncoo/spring-boot-demo</span><br><span class="line">SERVICE_NAME=spring-boot-demo-31-1-0.0.1-SNAPSHOT</span><br><span class="line">SPRING_PROFILES_ACTIVE=dev</span><br><span class="line"></span><br><span class="line">## java env</span><br><span class="line">export JAVA_HOME=/opt/jdk1.7.0_79</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in </span><br><span class="line">	start)</span><br><span class="line">		procedure=`ps -ef | grep -w &quot;$&#123;SERVICE_NAME&#125;&quot; |grep -w &quot;java&quot;| grep -v &quot;grep&quot; | awk &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">		if [ &quot;$&#123;procedure&#125;&quot; = &quot;&quot; ];</span><br><span class="line">		then</span><br><span class="line">			echo &quot;start ...&quot;</span><br><span class="line">			if [ &quot;$2&quot; != &quot;&quot; ];</span><br><span class="line">			then</span><br><span class="line">				SPRING_PROFILES_ACTIVE=$2</span><br><span class="line">			fi</span><br><span class="line">			echo &quot;spring.profiles.active=$&#123;SPRING_PROFILES_ACTIVE&#125;&quot;</span><br><span class="line">			exec nohup $&#123;JRE_HOME&#125;/bin/java -Xms128m -Xmx512m -jar $&#123;SERVICE_DIR&#125;/$&#123;SERVICE_NAME&#125;\.jar --spring.profiles.active=$&#123;SPRING_PROFILES_ACTIVE&#125; &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">			echo &quot;start success&quot;</span><br><span class="line">		else</span><br><span class="line">			echo &quot;$&#123;SERVICE_NAME&#125; is start&quot;</span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line">		</span><br><span class="line">	stop)</span><br><span class="line">		procedure=`ps -ef | grep -w &quot;$&#123;SERVICE_NAME&#125;&quot; |grep -w &quot;java&quot;| grep -v &quot;grep&quot; | awk &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">		if [ &quot;$&#123;procedure&#125;&quot; = &quot;&quot; ];</span><br><span class="line">		then</span><br><span class="line">			echo &quot;$&#123;SERVICE_NAME&#125; is stop&quot;</span><br><span class="line">		else</span><br><span class="line">			kill -9 $&#123;procedure&#125;</span><br><span class="line">			sleep 1</span><br><span class="line">			argprocedure=`ps -ef | grep -w &quot;$&#123;SERVICE_NAME&#125;&quot; |grep -w &quot;java&quot;| grep -v &quot;grep&quot; | awk &apos;&#123;print $2&#125;&apos;`</span><br><span class="line">			if [ &quot;$&#123;argprocedure&#125;&quot; = &quot;&quot; ];</span><br><span class="line">			then</span><br><span class="line">				echo &quot;$&#123;SERVICE_NAME&#125; stop success&quot;</span><br><span class="line">			else</span><br><span class="line">				kill -9 $&#123;argprocedure&#125;</span><br><span class="line">				echo &quot;$&#123;SERVICE_NAME&#125; stop error&quot;</span><br><span class="line">			fi</span><br><span class="line">		fi</span><br><span class="line">		;;</span><br><span class="line">		</span><br><span class="line">	restart)</span><br><span class="line">		$0 stop</span><br><span class="line">		sleep 1</span><br><span class="line">		$0 start $2</span><br><span class="line">		;;  </span><br><span class="line">		</span><br><span class="line">	*)</span><br><span class="line">		echo &quot;usage: $0 [start|stop|restart] [dev|test|prod]&quot;</span><br><span class="line">		;;  </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    


<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>欢迎和博主一起玩耍呀-------------</div>
    
</div>
  
</div>
<div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
  
  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/post/springboot进阶.html">SpringBoot进阶</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 AsherCode 的个人博客">AsherCode</a></p>
  <p><span>发布时间:</span>2018年03月26日 - 14:03</p>
  <p><span>最后更新:</span>2018年03月30日 - 10:03</p>
  <p><span>原始链接:</span><a href="/post/springboot进阶.html" title="SpringBoot进阶">http://ashercode.github.io/post/springboot进阶.html</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://ashercode.github.io/post/springboot进阶.html"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>

      
</div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>请博主吃包辣条</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="AsherCode 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="AsherCode 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/redis/" rel="tag"><i class="fa fa-tag"></i> redis</a>
          
            <a href="/tags/mongodb/" rel="tag"><i class="fa fa-tag"></i> mongodb</a>
          
            <a href="/tags/Spring-boot/" rel="tag"><i class="fa fa-tag"></i> Spring boot</a>
          
            <a href="/tags/Swagger/" rel="tag"><i class="fa fa-tag"></i> Swagger</a>
          
            <a href="/tags/JMS/" rel="tag"><i class="fa fa-tag"></i> JMS</a>
          
            <a href="/tags/AMQP/" rel="tag"><i class="fa fa-tag"></i> AMQP</a>
          
            <a href="/tags/EhCache/" rel="tag"><i class="fa fa-tag"></i> EhCache</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/springboot入门.html" rel="next" title="springboot入门">
                <i class="fa fa-chevron-left"></i> springboot入门
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/SpringBoot高并发商城秒杀.html" rel="prev" title="SpringBoot高并发商城秒杀">
                SpringBoot高并发商城秒杀 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2152116" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzg0MC8xMDM5Mw=="></div>
    </div>

  
   



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="AsherCode" />
            
              <p class="site-author-name" itemprop="name">AsherCode</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ashercode" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/u/5317695564/home" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://ashercode.github.io" title="本站孪生地址" target="_blank">本站孪生地址</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Restfull快速搭建"><span class="nav-number">1.</span> <span class="nav-text">Restfull快速搭建</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置文件"><span class="nav-number">2.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置多环境"><span class="nav-number">3.</span> <span class="nav-text">配置多环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#properties"><span class="nav-number">3.1.</span> <span class="nav-text">properties</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yaml"><span class="nav-number">3.2.</span> <span class="nav-text">yaml</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#日志管理"><span class="nav-number">4.</span> <span class="nav-text">日志管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#log4j2"><span class="nav-number">4.1.</span> <span class="nav-text">log4j2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#logback"><span class="nav-number">4.2.</span> <span class="nav-text">logback</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#模板引擎"><span class="nav-number">5.</span> <span class="nav-text">模板引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Freemarker"><span class="nav-number">5.1.</span> <span class="nav-text">Freemarker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thymeleaf"><span class="nav-number">5.2.</span> <span class="nav-text">Thymeleaf</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#异常处理"><span class="nav-number">6.</span> <span class="nav-text">异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实现ErrorController接口"><span class="nav-number">6.1.</span> <span class="nav-text">实现ErrorController接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#默认异常处理文件"><span class="nav-number">6.2.</span> <span class="nav-text">默认异常处理文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注解处理异常"><span class="nav-number">6.3.</span> <span class="nav-text">注解处理异常</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sevelet-listener-filter"><span class="nav-number">7.</span> <span class="nav-text">sevelet,listener,filter</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#注册成Bean"><span class="nav-number">7.1.</span> <span class="nav-text">注册成Bean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ServletContextInitializer直接注册"><span class="nav-number">7.2.</span> <span class="nav-text">ServletContextInitializer直接注册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注解注册"><span class="nav-number">7.3.</span> <span class="nav-text">注解注册</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#跨域"><span class="nav-number">8.</span> <span class="nav-text">跨域</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#全局配置"><span class="nav-number">8.1.</span> <span class="nav-text">全局配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#细粒度注解"><span class="nav-number">8.2.</span> <span class="nav-text">细粒度注解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文件上传"><span class="nav-number">9.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集成JdbcTemplate"><span class="nav-number">10.</span> <span class="nav-text">集成JdbcTemplate</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#springboot-data-jpa"><span class="nav-number">11.</span> <span class="nav-text">springboot_data_jpa</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#事务处理"><span class="nav-number">12.</span> <span class="nav-text">事务处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#事务有四个特性：ACID"><span class="nav-number">12.1.</span> <span class="nav-text">事务有四个特性：ACID</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传播行为"><span class="nav-number">12.2.</span> <span class="nav-text">传播行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#隔离级别"><span class="nav-number">12.3.</span> <span class="nav-text">隔离级别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#属性说明-Transactional"><span class="nav-number">12.4.</span> <span class="nav-text">属性说明 @Transactional</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#springboot-h2"><span class="nav-number">13.</span> <span class="nav-text">springboot_h2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置redis"><span class="nav-number">14.</span> <span class="nav-text">配置redis</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集成mongodb"><span class="nav-number">15.</span> <span class="nav-text">集成mongodb</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#方法MongoTemplate"><span class="nav-number">15.1.</span> <span class="nav-text">方法MongoTemplate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方法MongoRepository"><span class="nav-number">15.2.</span> <span class="nav-text">方法MongoRepository</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集成Ehcache"><span class="nav-number">16.</span> <span class="nav-text">集成Ehcache</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#springboot-redis-cache集成"><span class="nav-number">17.</span> <span class="nav-text">springboot_redis cache集成</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#异步消息JMS-ActiveMQ"><span class="nav-number">18.</span> <span class="nav-text">异步消息JMS_ActiveMQ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#异步消息AMQP——RabbitMQ"><span class="nav-number">19.</span> <span class="nav-text">异步消息AMQP——RabbitMQ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#调用远程rest服务及使用代理"><span class="nav-number">20.</span> <span class="nav-text">调用远程rest服务及使用代理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#项目一"><span class="nav-number">20.1.</span> <span class="nav-text">项目一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目二"><span class="nav-number">20.2.</span> <span class="nav-text">项目二</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#多账号发送邮件"><span class="nav-number">21.</span> <span class="nav-text">多账号发送邮件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#spring-session-cluster"><span class="nav-number">22.</span> <span class="nav-text">spring_session_cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#项目一-1"><span class="nav-number">22.1.</span> <span class="nav-text">项目一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目二-1"><span class="nav-number">22.2.</span> <span class="nav-text">项目二</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#远程调试"><span class="nav-number">23.</span> <span class="nav-text">远程调试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基于HTTP的监控"><span class="nav-number">24.</span> <span class="nav-text">基于HTTP的监控</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#springboot-mybatis"><span class="nav-number">25.</span> <span class="nav-text">springboot_mybatis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#注解"><span class="nav-number">25.1.</span> <span class="nav-text">注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xml配置"><span class="nav-number">25.2.</span> <span class="nav-text">xml配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集成Druid"><span class="nav-number">26.</span> <span class="nav-text">集成Druid</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集成swagger"><span class="nav-number">27.</span> <span class="nav-text">集成swagger</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#生产环境脚本"><span class="nav-number">28.</span> <span class="nav-text">生产环境脚本</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AsherCode</span>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共128.5k字</span>
</div>
  
</div>








        
<div class="busuanzi-count">
  <script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.3"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("mvlpA2l2DQuXENSGQgGyvWEx-gzGzoHsz", "BPLBwOm9OSqs2LtI5jIHvcSW");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "default";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
<div id="hexo-helper-live2d">
  <canvas id="live2dcanvas" width="150" height="300"></canvas>
</div>
<style>
  #live2dcanvas{
    position: fixed;
    width: 150px;
    height: 300px;
    opacity:0.7;
    right: -30px;
    z-index: 999;
    pointer-events: none;
    bottom: 40px;
  }
</style>
<script type="text/javascript" src="/live2d/device.min.js"></script>
<script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    var trElement = document.getElementById('hexo-helper-live2d');
    trElement.parentNode.removeChild(trElement);
    return;
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script>

</body>
</html>
<!-- ҳ������С���� -->
<script type="text/javascript" src="/js/src/love.js"></script>